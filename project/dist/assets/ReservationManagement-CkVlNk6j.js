import{aj as N,j as e,an as _t,r as l,s as y,Q as f,E as j,H as ee,J as ke,B as i,C as It,A as Bt,P as R,K as Pt,L as te,ao as zt,ap as Wt,G as d,p as Ge,t as Ve,T as s,$ as He,aq as Et,k as Ne,n as Ye,ar as Oe,a as p,as as Je,F as G,I as V,S as H,M as u,a0 as se,at as re,y as W,R as Ft,U as Mt,V as Ut,W as $t,au as Xe,av as Ze,aw as et,ax as tt,ay as st,az as rt,aA as A,aB as at,aC as nt,D as ae,h as ne,i as ie,l as oe}from"./index-z-43rxTh.js";import{a as le,i as de}from"./isToday-CCB4hpkQ.js";import{i as ce}from"./isTomorrow-C5dBabq1.js";const Kt=N(e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2M9 17H7v-7h2zm4 0h-2V7h2zm4 0h-2v-4h2z"}),"Assessment"),it=N(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel"),ot=N(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle"),lt=N(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-6h2zm0-8h-2V7h2z"}),"Info"),Qt=N(e.jsx("path",{d:"M23 8c0 1.1-.9 2-2 2-.18 0-.35-.02-.51-.07l-3.56 3.55c.05.16.07.34.07.52 0 1.1-.9 2-2 2s-2-.9-2-2c0-.18.02-.36.07-.52l-2.55-2.55c-.16.05-.34.07-.52.07s-.36-.02-.52-.07l-4.55 4.56c.05.16.07.33.07.51 0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2c.18 0 .35.02.51.07l4.56-4.55C8.02 9.36 8 9.18 8 9c0-1.1.9-2 2-2s2 .9 2 2c0 .18-.02.36-.07.52l2.55 2.55c.16-.05.34-.07.52-.07s.36.02.52.07l3.55-3.56C19.02 8.35 19 8.18 19 8c0-1.1.9-2 2-2s2 .9 2 2"}),"Timeline");function he(o){const{children:S,value:Y,index:b,...ue}=o;return e.jsx("div",{role:"tabpanel",hidden:Y!==b,id:`reservation-tabpanel-${b}`,"aria-labelledby":`reservation-tab-${b}`,...ue,children:Y===b&&e.jsx(i,{sx:{pt:3},children:S})})}function Ot(){const o=_t(),[S,Y]=l.useState([]),[b,ue]=l.useState([]),[dt,T]=l.useState(!0),[Le,E]=l.useState(null),[F,ct]=l.useState(0),[M,Re]=l.useState(""),[xe,ht]=l.useState(""),[me,Ae]=l.useState(""),[pe,Te]=l.useState(""),[U,qe]=l.useState(""),[je,_e]=l.useState(""),[ge,Ie]=l.useState(""),[ve,ut]=l.useState(!1),[ye,xt]=l.useState(!1),[c,O]=l.useState(null),[x,J]=l.useState(null),[mt,P]=l.useState(!1),[pt,q]=l.useState(!1),[jt,X]=l.useState(!1),[gt,z]=l.useState(!1),[vt,yt]=l.useState([]),[I,$]=l.useState(null),[B,fe]=l.useState(null),[Be,Pe]=l.useState([]),[ze,ft]=l.useState([]),[Gt,bt]=l.useState([]),[K,We]=l.useState({total:0,pending:0,approved:0,denied:0,cancelled:0,completed:0,utilizationRate:"0.00"}),[be,Ct]=l.useState({labtotal:0,pending:0,approved:0,denied:0,cancelled:0,completed:0,labutilizationRate:"0.00"}),[wt,St]=l.useState([]),[Dt,kt]=l.useState([]);l.useEffect(()=>{const t=async()=>{const{data:a}=await y.from("reservations").select("*").not("status","in","(completed, cancelled, denied)");for(const n of a||[]){const m=j(n.end_time);ke(m,new Date)&&await y.from("reservations").update({status:"completed"}).eq("id",n.id)}Ce()};Ce(),Lt(),Ee(),t(),Rt();const r=setInterval(t,6e4);return()=>clearInterval(r)},[]);const Ce=async()=>{try{T(!0);const{data:{user:t}}=await y.auth.getUser();if(!t)throw new Error("User not authenticated");const r=t.id,{data:a,error:n}=await y.from("lab").select("id").eq("manager_id",r);if(n)throw n;const m=a.map(g=>g.id),{data:h,error:k}=await y.from("equipment").select("*").in("lab_id",m);if(k)throw k;const Q=h.map(g=>g.id),De=h.reduce((g,w)=>{const v=w.quantity||1;return g+v},0);Pe(h);const[_,D]=await Promise.all([y.from("reservations").select(`
            *,
            equipment (
              id,
              name,
              category,
              manufacturer,
              model,
              image_url,
              lab_id
            ),
            users (
              id,
              email,
              department,
              role
            )
          `).in("equipment_id",Q).order("created_at",{ascending:!1}),y.from("equipment").select("*").order("name")]);if(_.error)throw _.error;if(D.error)throw D.error;Y(_.data),Pe(D.data);const L=_.data.reduce((g,w)=>(g.total++,g[w.status]++,g),{total:0,pending:0,approved:0,denied:0,cancelled:0,completed:0,utilizationRate:"0.00"});We(L);const C=_.data.filter(g=>g.status==="completed").reduce((g,w)=>{const v=w.quantity||1;return g+v},0),Tt=De>0?Math.min(C/De*100,100):0;We(g=>({...g,utilizationRate:Tt.toFixed(2)}));const qt=Array.from({length:7},(g,w)=>{const v=le(new Date,-w);return f(v,"yyyy-MM-dd")}).reverse().map(g=>{const w=_.data.filter(v=>f(j(v.created_at),"yyyy-MM-dd")===g);return{date:f(j(g),"MMM dd"),total:w.length,approved:w.filter(v=>v.status==="approved").length,pending:w.filter(v=>v.status==="pending").length,completed:w.filter(v=>v.status==="completed").length,cancelled:w.filter(v=>v.status==="cancelled").length,denied:w.filter(v=>v.status==="denied").length}});St(qt)}catch(t){E(t.message)}finally{T(!1)}},Lt=async()=>{try{const{data:t,error:r}=await y.from("equipment").select("category").eq("status","operational");if(r)throw r;const a=[...new Set(t.map(n=>n.category))];yt(a)}catch(t){console.error("Error fetching categories:",t)}},Ee=async()=>{try{T(!0);const{data:{user:t}}=await y.auth.getUser();if(!t)throw new Error("User not authenticated");const r=t.id,{data:a,error:n}=await y.from("lab").select("id").eq("manager_id",r);if(n)throw n;const m=a.map(D=>D.id),[h,k]=await Promise.all([y.from("lab_reservations").select(`*,
            lab (
              id,
              name,
              location,
              image_url
            ),
            users (
              id,
              email,
              department,
              role
            )
          `).in("lab_id",m).order("created_at",{ascending:!1}),y.from("lab").select("*").eq("manager_id",r).order("name")]);if(h.error)throw h.error;if(k.error)throw k.error;ue(h.data),ft(k.data);const Q=h.data.reduce((D,L)=>(D.labtotal++,D[L.status]++,D),{labtotal:0,pending:0,approved:0,denied:0,cancelled:0,completed:0,labutilizationRate:"0.00"});Ct(Q);const _=Array.from({length:7},(D,L)=>{const C=le(new Date,-L);return f(C,"yyyy-MM-dd")}).reverse().map(D=>{const L=h.data.filter(C=>f(j(C.created_at),"yyyy-MM-dd")===D);return{date:f(j(D),"MMM dd"),labtotal:L.length,approved:L.filter(C=>C.status==="approved").length,pending:L.filter(C=>C.status==="pending").length,completed:L.filter(C=>C.status==="completed").length,cancelled:L.filter(C=>C.status==="cancelled").length,denied:L.filter(C=>C.status==="denied").length}});kt(_)}catch(t){E(t.message)}finally{T(!1)}},Rt=async()=>{try{const{data:t,error:r}=await y.from("users").select("id, email, role").order("created_at",{ascending:!1});if(r)throw r;bt(t||[])}catch(t){E(t.message)}},Fe=async(t,r,a,n,m)=>{try{const{error:h}=await y.from("notifications").insert([{id:crypto.randomUUID(),user_id:t,created_by:r,title:a,message:n,type:m,read:!1,created_at:new Date().toISOString()}]);if(h)throw h}catch(h){console.error("Error sending notification to user:",h.message)}},Me=async(t,r)=>{try{T(!0);const{error:a}=await y.from("reservations").update({status:r}).eq("id",t);if(a)throw a;await Fe(c.user_id,"System",`Reservation ${r}`,`Your reservation for ${c.equipment.name} has been ${r}.`,"reservation"),Ce(),q(!1),P(!1)}catch(a){E(a.message)}finally{T(!1)}},Ue=async(t,r)=>{try{T(!0);const{error:a}=await y.from("lab_reservations").update({status:r}).eq("id",t);if(a)throw a;await Fe(x.user_id,"System",`Lab Reservation ${r}`,`Your lab reservation for ${x.lab.name} has been ${r}.`,"lab_reservation"),Ee(),z(!1),X(!1)}catch(a){E(a.message)}finally{T(!1)}},we=S.filter(t=>{const r=t.equipment?.name.toLowerCase().includes(M.toLowerCase())||t.users?.email.toLowerCase().includes(M.toLowerCase())||t.purpose?.toLowerCase().includes(M.toLowerCase())||t.quantity?.toString().includes(M.toLowerCase()),a=!xe||t.status===xe,n=!me||t.equipment?.category===me;let m=!0;if(pe){const h=j(t.start_time),k=new Date;switch(pe){case"today":m=de(h);break;case"tomorrow":m=ce(h);break;case"upcoming":m=ee(h,k);break;case"thisWeek":const Q=le(k,7);m=ee(h,k)&&ke(h,Q);break}}return r&&a&&n&&m}),Se=b.filter(t=>{const r=t.lab?.name.toLowerCase().includes(U.toLowerCase())||t.users?.email.toLowerCase().includes(U.toLowerCase())||t.purpose?.toLowerCase().includes(U.toLowerCase())||t.attendees?.toString().includes(U.toLowerCase()),a=!je||t.status===je;let n=!0;if(ge){const m=j(t.start_time),h=new Date;switch(ge){case"today":n=de(m);break;case"tomorrow":n=ce(m);break;case"upcoming":n=ee(m,h);break;case"thisWeek":const k=le(h,7);n=ee(m,h)&&ke(m,k);break}}return r&&a&&n}),At=[...we.map(t=>({id:t.id,title:`${t.equipment?.name} - ${t.users?.email}`,start:t.start_time,end:t.end_time,allDay:!1,backgroundColor:$e(t.status),borderColor:Ke(t.status),textColor:Qe(t.status)})),...Se.map(t=>({id:t.id,title:`${t.lab?.name} - ${t.users?.email}`,start:t.start_time,end:t.end_time,allDay:!1,backgroundColor:$e(t.status),borderColor:Ke(t.status),textColor:Qe(t.status)}))];function $e(t){switch(t){case"completed":return o.palette.info.light;case"cancelled":return o.palette.error.light;case"approved":return o.palette.success.light;case"pending":return o.palette.warning.light;case"denied":return o.palette.error.light;default:return o.palette.grey[300]}}function Ke(t){switch(t){case"completed":return o.palette.info.main;case"cancelled":return o.palette.error.main;case"approved":return o.palette.success.main;case"pending":return o.palette.warning.main;case"denied":return o.palette.error.main;default:return o.palette.grey[500]}}function Qe(t){switch(t){case"completed":case"approved":case"pending":case"denied":case"cancelled":return"#fff";default:return o.palette.text.primary}}const Z=t=>{switch(t){case"completed":return"info";case"approved":return"success";case"pending":return"warning";case"denied":return"error";case"cancelled":return"default";default:return"default"}};return dt&&S.length===0?e.jsx(i,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(It,{})}):Le?e.jsx(Bt,{severity:"error",sx:{mt:4},children:Le}):e.jsxs(i,{children:[e.jsxs(R,{sx:{width:"100%",mb:3},children:[e.jsxs(Pt,{value:F,onChange:(t,r)=>ct(r),children:[e.jsx(te,{icon:e.jsx(Kt,{}),label:"Equipment"}),e.jsx(te,{icon:e.jsx(zt,{}),label:"Lab"}),e.jsx(te,{icon:e.jsx(Wt,{}),label:"Calendar"}),e.jsx(te,{icon:e.jsx(Qt,{}),label:"Analytics"})]}),e.jsxs(he,{value:F,index:0,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Ge,{children:e.jsxs(Ve,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,fontWeight:"bold",children:"Equipment Reservation Status Summary"}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsxs(i,{sx:{textAlign:"center",p:1},children:[e.jsx(s,{variant:"h4",color:"info",children:K.total}),e.jsx(s,{variant:"body2",children:"Total Equipment Reservations"})]}),e.jsxs(i,{sx:{textAlign:"center",p:1},children:[e.jsx(s,{variant:"h4",color:"warning.main",children:S.filter(t=>t.status==="pending").length}),e.jsx(s,{variant:"body2",children:"Pending"})]}),e.jsxs(i,{sx:{textAlign:"center",p:1},children:[e.jsx(s,{variant:"h4",color:"success.main",children:S.filter(t=>t.status==="approved").length}),e.jsx(s,{variant:"body2",children:"Approved"})]}),e.jsxs(i,{sx:{textAlign:"center",p:1},children:[e.jsx(s,{variant:"h4",color:"error.main",children:S.filter(t=>t.status==="denied").length}),e.jsx(s,{variant:"body2",children:"Denied"})]}),e.jsxs(i,{sx:{textAlign:"center",p:1},children:[e.jsx(s,{variant:"h4",color:"text.secondary",children:S.filter(t=>t.status==="cancelled").length}),e.jsx(s,{variant:"body2",children:"Cancelled"})]}),e.jsxs(i,{sx:{textAlign:"center",p:1},children:[e.jsx(s,{variant:"h4",color:"info.main",children:S.filter(t=>t.status==="completed").length}),e.jsx(s,{variant:"body2",children:"Completed"})]})]}),e.jsx(He,{sx:{my:2}}),e.jsxs(s,{variant:"subtitle1",gutterBottom:!0,children:["Today's Reservations: ",S.filter(t=>{const r=j(t.start_time);return de(r)}).length]}),e.jsxs(s,{variant:"subtitle1",gutterBottom:!0,children:["Tomorrow's Reservations: ",S.filter(t=>{const r=j(t.start_time);return ce(r)}).length]}),e.jsx(s,{color:"textSecondary",gutterBottom:!0,children:"Equipment Utilization Rate"}),e.jsxs(s,{variant:"h4",color:"info.main",children:[K.utilizationRate||"0.00","%"]}),e.jsx(Et,{variant:"determinate",value:parseFloat(K.utilizationRate)||0,color:"info",sx:{mt:2,height:8,borderRadius:4}})]})})}),e.jsxs(R,{sx:{p:2,mb:3,mt:2},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(Ne,{placeholder:"Search reservations...",size:"small",value:M,onChange:t=>Re(t.target.value),InputProps:{startAdornment:e.jsx(Ye,{position:"start",children:e.jsx(Oe,{})})},sx:{width:300}}),e.jsx(p,{variant:"outlined",startIcon:e.jsx(Je,{}),onClick:()=>ut(!ve),children:ve?"Hide Filters":"Show Filters"})]}),ve&&e.jsx(i,{sx:{mt:2},children:e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,sm:4,children:e.jsxs(G,{fullWidth:!0,size:"small",children:[e.jsx(V,{children:"Status"}),e.jsxs(H,{value:xe,label:"Status",onChange:t=>ht(t.target.value),children:[e.jsx(u,{value:"",children:"All Status"}),e.jsx(u,{value:"pending",children:"Pending"}),e.jsx(u,{value:"approved",children:"Approved"}),e.jsx(u,{value:"denied",children:"Denied"}),e.jsx(u,{value:"cancelled",children:"Cancelled"}),e.jsx(u,{value:"completed",children:"Completed"})]})]})}),e.jsx(d,{item:!0,xs:12,sm:4,children:e.jsxs(G,{fullWidth:!0,size:"small",children:[e.jsx(V,{children:"Category"}),e.jsxs(H,{value:me,label:"Category",onChange:t=>Ae(t.target.value),children:[e.jsx(u,{value:"",children:"All Categories"}),vt.map(t=>e.jsx(u,{value:t,children:t},t))]})]})}),e.jsx(d,{item:!0,xs:12,sm:4,children:e.jsxs(G,{fullWidth:!0,size:"small",children:[e.jsx(V,{children:"Date"}),e.jsxs(H,{value:pe,label:"Date",onChange:t=>Te(t.target.value),children:[e.jsx(u,{value:"",children:"All Dates"}),e.jsx(u,{value:"today",children:"Today"}),e.jsx(u,{value:"tomorrow",children:"Tomorrow"}),e.jsx(u,{value:"upcoming",children:"Upcoming"}),e.jsx(u,{value:"thisWeek",children:"This Week"})]})]})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(i,{sx:{mt:2,display:"flex",justifyContent:"flex-end"},children:e.jsx(p,{variant:"text",onClick:()=>{Re(""),Ae(""),Te("")},children:"Clear Filters"})})})]})})]}),e.jsxs(se,{children:[we.map(t=>e.jsx(R,{sx:{mb:2},children:e.jsx(re,{children:e.jsxs(i,{sx:{width:"100%"},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[e.jsxs(i,{children:[e.jsx(s,{variant:"h6",children:t.equipment?.name}),e.jsxs(s,{variant:"body2",color:"textSecondary",children:["Reserved by: ",t.users?.email]})]}),e.jsx(W,{label:t.status,color:Z(t.status),size:"small"})]}),e.jsxs(d,{container:!0,spacing:2,sx:{mt:1},children:[e.jsxs(d,{item:!0,xs:12,md:6,children:[e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Start:"})," ",f(j(t.start_time),"PPpp")]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"End:"})," ",f(j(t.end_time),"PPpp")]})]}),e.jsxs(d,{item:!0,xs:12,md:6,children:[e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Department:"})," ",t.users?.department]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Equipment Category:"})," ",t.equipment?.category]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Quantity:"}),t.quantity]})]})]}),e.jsxs(i,{sx:{mt:2,display:"flex",gap:1},children:[e.jsx(p,{size:"small",variant:"outlined",onClick:()=>{O(t),P(!0)},startIcon:e.jsx(lt,{}),children:"Details"}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(p,{size:"small",variant:"contained",color:"success",onClick:()=>{O(t),$("approve"),q(!0)},startIcon:e.jsx(ot,{}),children:"Approve"}),e.jsx(p,{size:"small",variant:"contained",color:"error",onClick:()=>{O(t),$("deny"),q(!0)},startIcon:e.jsx(it,{}),children:"Deny"})]})]})]})})},t.id)),we.length===0&&e.jsx(s,{variant:"body1",sx:{textAlign:"center",mt:4},children:"No Equipment reservations found."})]})]}),e.jsxs(he,{value:F,index:1,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsx(Ge,{children:e.jsxs(Ve,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,fontWeight:"bold",children:"Lab Reservation Status Summary"}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsxs(i,{sx:{textAlign:"center",p:1},children:[e.jsx(s,{variant:"h4",color:"info",children:be.labtotal}),e.jsx(s,{variant:"body2",children:"Total Lab Reservations"})]}),e.jsxs(i,{sx:{textAlign:"center",p:1},children:[e.jsx(s,{variant:"h4",color:"warning.main",children:b.filter(t=>t.status==="pending").length}),e.jsx(s,{variant:"body2",children:"Pending"})]}),e.jsxs(i,{sx:{textAlign:"center",p:1},children:[e.jsx(s,{variant:"h4",color:"success.main",children:b.filter(t=>t.status==="approved").length}),e.jsx(s,{variant:"body2",children:"Approved"})]}),e.jsxs(i,{sx:{textAlign:"center",p:1},children:[e.jsx(s,{variant:"h4",color:"error.main",children:b.filter(t=>t.status==="denied").length}),e.jsx(s,{variant:"body2",children:"Denied"})]}),e.jsxs(i,{sx:{textAlign:"center",p:1},children:[e.jsx(s,{variant:"h4",color:"text.secondary",children:b.filter(t=>t.status==="cancelled").length}),e.jsx(s,{variant:"body2",children:"Cancelled"})]}),e.jsxs(i,{sx:{textAlign:"center",p:1},children:[e.jsx(s,{variant:"h4",color:"info.main",children:b.filter(t=>t.status==="completed").length}),e.jsx(s,{variant:"body2",children:"Complated"})]})]}),e.jsx(He,{sx:{my:2}}),e.jsxs(s,{variant:"subtitle1",gutterBottom:!0,children:["Today's Lab Reservation: ",b.filter(t=>{const r=j(t.start_time);return de(r)}).length]}),e.jsxs(s,{variant:"subtitle1",gutterBottom:!0,children:["Tomorrow's Reservations: ",b.filter(t=>{const r=j(t.start_time);return ce(r)}).length]})]})})}),e.jsxs(R,{sx:{p:2,mb:3,mt:2},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(Ne,{placeholder:"Search Lab reservations...",size:"small",value:U,onChange:t=>qe(t.target.value),InputProps:{startAdornment:e.jsx(Ye,{position:"start",children:e.jsx(Oe,{})})},sx:{width:300}}),e.jsx(p,{variant:"outlined",startIcon:e.jsx(Je,{}),onClick:()=>xt(!ye),children:ye?"Hide Filters":"Show Filters"})]}),ye&&e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,sm:4,children:e.jsxs(G,{fullWidth:!0,size:"small",children:[e.jsx(V,{children:"Status"}),e.jsxs(H,{value:je,label:"Status",onChange:t=>_e(t.target.value),children:[e.jsx(u,{value:"",children:"All Status"}),e.jsx(u,{value:"pending",children:"Pending"}),e.jsx(u,{value:"approved",children:"Approved"}),e.jsx(u,{value:"denied",children:"Denied"}),e.jsx(u,{value:"cancelled",children:"Cancelled"}),e.jsx(u,{value:"completed",children:"Completed"})]})]})}),e.jsx(d,{item:!0,xs:12,sm:4,children:e.jsxs(G,{fullWidth:!0,size:"small",children:[e.jsx(V,{children:"Date"}),e.jsxs(H,{value:ge,label:"Date",onChange:t=>Ie(t.target.value),children:[e.jsx(u,{value:"",children:"All Dates"}),e.jsx(u,{value:"today",children:"Today"}),e.jsx(u,{value:"tomorrow",children:"Tomorrow"}),e.jsx(u,{value:"upcoming",children:"Upcoming"}),e.jsx(u,{value:"thisWeek",children:"This Week"})]})]})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(i,{sx:{mt:2,display:"flex",justifyContent:"flex-end"},children:e.jsx(p,{variant:"text",onClick:()=>{qe(""),_e(""),Ie("")},children:"Clear Filters"})})})]})]}),e.jsx(d,{item:!0,mt:2,children:Se.length>0?e.jsx(se,{children:Se.map(t=>e.jsx(R,{sx:{mb:2},children:e.jsx(re,{children:e.jsxs(i,{sx:{width:"100%"},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[e.jsxs(i,{children:[e.jsx(s,{variant:"h6",children:t.lab?.name}),e.jsxs(s,{variant:"body2",color:"textSecondary",children:["Reserved by: ",t.users?.email?.split("@")[0]||"Unknown User"]})]}),e.jsx(W,{label:t.status,color:Z(t.status),size:"small"})]}),e.jsxs(d,{container:!0,spacing:2,sx:{mt:1},children:[e.jsxs(d,{item:!0,xs:12,md:6,children:[e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Start:"})," ",f(j(t.start_time),"PPpp")]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"End:"})," ",f(j(t.end_time),"PPpp")]})]}),e.jsxs(d,{item:!0,xs:12,md:6,children:[e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Department:"})," ",t.users?.department||"Unknown Department"]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Lab Location:"})," ",t.lab?.location||"Unknown Location"]})]})]}),e.jsxs(i,{sx:{mt:2,display:"flex",gap:1},children:[e.jsx(p,{size:"small",variant:"outlined",onClick:()=>{J(t),X(!0)},startIcon:e.jsx(lt,{}),children:"Details"}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(p,{size:"small",variant:"contained",color:"success",onClick:()=>{J(t),fe("approve"),z(!0)},startIcon:e.jsx(ot,{}),children:"Approve"}),e.jsx(p,{size:"small",variant:"contained",color:"error",onClick:()=>{J(t),$("deny"),q(!0)},startIcon:e.jsx(it,{}),children:"Deny"})]})]})]})})},t.id))}):e.jsx(s,{variant:"body1",sx:{textAlign:"center",mt:4},children:"No lab reservations found."})})]}),e.jsx(he,{value:F,index:2,children:e.jsx(R,{sx:{p:2},children:e.jsx(Ft,{plugins:[Mt,Ut,$t],initialView:"timeGridWeek",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},events:At,eventClick:t=>{const r=S.find(n=>n.id===t.event.id);r&&(O(r),P(!0));const a=b.find(n=>n.id===t.event.id);a&&(J(a),X(!0))},height:"auto",aspectRatio:1.5})})}),e.jsx(he,{value:F,index:3,children:e.jsxs(d,{container:!0,spacing:4,children:[e.jsx(d,{item:!0,xs:12,children:e.jsxs(R,{sx:{p:3,borderRadius:4,boxShadow:3},children:[e.jsx(s,{variant:"h5",gutterBottom:!0,sx:{fontWeight:"bold",color:o.palette.primary.main},children:"Equipment Reservation Trends"}),e.jsx(Xe,{width:"100%",height:350,children:e.jsxs(Ze,{data:wt,children:[e.jsx(et,{strokeDasharray:"3 3"}),e.jsx(tt,{dataKey:"date",tick:{fontSize:12}}),e.jsx(st,{tick:{fontSize:12}}),e.jsx(rt,{contentStyle:{backgroundColor:"#fff",border:"1px solid #ddd"}}),e.jsx(A,{type:"monotone",dataKey:"total",name:"Total",stroke:o.palette.primary.main,strokeWidth:2}),e.jsx(A,{type:"monotone",dataKey:"approved",name:"Approved",stroke:o.palette.success.main,strokeWidth:2}),e.jsx(A,{type:"monotone",dataKey:"pending",name:"Pending",stroke:o.palette.warning.main,strokeWidth:2}),e.jsx(A,{type:"monotone",dataKey:"completed",name:"Completed",stroke:o.palette.info.main,strokeWidth:2}),e.jsx(A,{type:"monotone",dataKey:"cancelled",name:"Cancelled",stroke:o.palette.error.main,strokeWidth:2})]})})]})}),e.jsx(d,{item:!0,xs:12,children:e.jsxs(R,{sx:{p:3,borderRadius:4,boxShadow:3},children:[e.jsx(s,{variant:"h5",gutterBottom:!0,sx:{fontWeight:"bold",color:o.palette.primary.main},children:"Lab Reservation Trends"}),e.jsx(Xe,{width:"100%",height:350,children:e.jsxs(Ze,{data:Dt,children:[e.jsx(et,{strokeDasharray:"3 3"}),e.jsx(tt,{dataKey:"date",tick:{fontSize:12}}),e.jsx(st,{tick:{fontSize:12}}),e.jsx(rt,{contentStyle:{backgroundColor:"#fff",border:"1px solid #ddd"}}),e.jsx(A,{type:"monotone",dataKey:"total",name:"Total",stroke:o.palette.primary.main,strokeWidth:2}),e.jsx(A,{type:"monotone",dataKey:"approved",name:"Approved",stroke:o.palette.success.main,strokeWidth:2}),e.jsx(A,{type:"monotone",dataKey:"pending",name:"Pending",stroke:o.palette.warning.main,strokeWidth:2}),e.jsx(A,{type:"monotone",dataKey:"completed",name:"Completed",stroke:o.palette.info.main,strokeWidth:2}),e.jsx(A,{type:"monotone",dataKey:"cancelled",name:"Cancelled",stroke:o.palette.error.main,strokeWidth:2})]})})]})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(R,{sx:{p:3,borderRadius:4,boxShadow:3},children:[e.jsx(s,{variant:"h5",gutterBottom:!0,sx:{fontWeight:"bold",color:o.palette.primary.main},children:"Equipment Usage"}),Be.length>0?e.jsx(se,{children:Be.map(t=>{const r=S.filter(n=>n.equipment_id===t.id&&["approved","completed"].includes(n.status)),a=K.total>0?r.length/K.total*100:0;return{...t,reservationCount:r.length,usagePercentage:Math.round(a)}}).filter(t=>t.reservationCount>0).sort((t,r)=>r.reservationCount-t.reservationCount).map(t=>e.jsxs(re,{sx:{py:1},children:[e.jsx(at,{primary:e.jsx(s,{variant:"subtitle1",sx:{fontWeight:"medium"},children:t.name}),secondary:`${t.reservationCount} reservations`}),e.jsx(nt,{children:e.jsx(W,{label:`${t.usagePercentage}%`,size:"small",sx:{backgroundColor:o.palette.primary.light,color:o.palette.common.white,fontWeight:"bold"}})})]},t.id))}):e.jsx(s,{variant:"body1",sx:{textAlign:"center",mt:4,color:o.palette.text.secondary},children:"No equipment data available."})]})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(R,{sx:{p:3,borderRadius:4,boxShadow:3},children:[e.jsx(s,{variant:"h5",gutterBottom:!0,sx:{fontWeight:"bold",color:o.palette.primary.main},children:"Lab Usage"}),ze.length>0?e.jsx(se,{children:ze.map(t=>{const r=b.filter(n=>n.lab_id===t.id&&["approved","completed"].includes(n.status)),a=be.labtotal>0?r.length/be.labtotal*100:0;return e.jsxs(re,{sx:{py:1},children:[e.jsx(at,{primary:e.jsx(s,{variant:"subtitle1",sx:{fontWeight:"medium"},children:t.name}),secondary:`${r.length} reservations`}),e.jsx(nt,{children:e.jsx(W,{label:`${Math.round(a)}%`,size:"small",sx:{backgroundColor:o.palette.primary.light,color:o.palette.common.white,fontWeight:"bold"}})})]},t.id)})}):e.jsx(s,{variant:"body1",sx:{textAlign:"center",mt:4,color:o.palette.text.secondary},children:"No lab data available."})]})})]})})]}),e.jsx(ae,{open:mt,onClose:()=>P(!1),maxWidth:"md",fullWidth:!0,children:c&&e.jsxs(e.Fragment,{children:[e.jsx(ne,{children:"Reservation Details"}),e.jsx(ie,{children:e.jsxs(d,{container:!0,spacing:3,children:[e.jsxs(d,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Equipment Information"}),e.jsx(i,{component:"img",src:c.equipment?.image_url||"https://picsum.photos/200/300",alt:c.equipment?.name,sx:{width:"100%",height:200,objectFit:"cover",borderRadius:1,mb:2}}),e.jsx(s,{variant:"subtitle1",gutterBottom:!0,children:c.equipment?.name}),e.jsxs(s,{variant:"body2",paragraph:!0,children:[c.equipment?.manufacturer," ",c.equipment?.model]}),e.jsxs(s,{variant:"body2",children:["Category: ",c.equipment?.category]})]}),e.jsxs(d,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Reservation Information"}),e.jsxs(i,{sx:{mb:3},children:[e.jsxs(s,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"Status:"})," ",e.jsx(W,{label:c.status,color:Z(c.status),size:"small"})]}),e.jsxs(s,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"Start Time:"})," ",f(j(c.start_time),"PPpp")]}),e.jsxs(s,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"End Time:"})," ",f(j(c.end_time),"PPpp")]}),e.jsxs(s,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"Created:"})," ",f(j(c.created_at),"PPpp")]}),e.jsx(s,{variant:"body2",children:e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Duration:"}),(()=>{const t=new Date(c.start_time);let a=new Date(c.end_time).getTime()-t.getTime();const n=Math.floor(a/(1e3*60*60));a-=n*(1e3*60*60);const m=Math.floor(a/(1e3*60));return`${n} hour(s), ${m} minute(s)`})()]})}),e.jsxs(s,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"Quantity:"})," ",c.quantity]})]}),e.jsx(s,{variant:"h6",gutterBottom:!0,children:"User Information"}),e.jsxs(i,{sx:{mb:3},children:[e.jsxs(s,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"Email:"})," ",c.users?.email]}),e.jsxs(s,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"Department:"})," ",c.users?.department]}),e.jsxs(s,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"Role:"})," ",c.users?.role]})]}),e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Purpose"}),e.jsx(s,{variant:"body2",children:c.purpose})]})]})}),e.jsxs(oe,{children:[e.jsx(p,{onClick:()=>P(!1),children:"Close"}),c.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(p,{color:"success",variant:"contained",onClick:()=>{$("approve"),q(!0)},children:"Approve"}),e.jsx(p,{color:"error",variant:"contained",onClick:()=>{$("deny"),q(!0)},children:"Deny"}),e.jsx(p,{color:"info",variant:"contained",onClick:()=>{Me(c.id,"completed")},children:"Mark as Completed"})]})]})]})}),e.jsx(ae,{open:jt,onClose:()=>P(!1),maxWidth:"md",fullWidth:!0,children:x&&e.jsxs(e.Fragment,{children:[e.jsx(ne,{children:"Reservation Details"}),e.jsx(ie,{children:e.jsxs(d,{container:!0,spacing:3,children:[e.jsxs(d,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Lab Information"}),e.jsx(i,{component:"img",src:x.lab?.image_url||"https://picsum.photos/200/300",alt:x.lab?.name,sx:{width:"100%",height:200,objectFit:"cover",borderRadius:1,mb:2}}),e.jsx(s,{variant:"subtitle1",gutterBottom:!0,children:x.lab?.name}),e.jsx(s,{variant:"body2",paragraph:!0,children:x.lab?.location})]}),e.jsxs(d,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Reservation Information"}),e.jsxs(i,{sx:{mb:3},children:[e.jsxs(s,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"Status:"})," ",e.jsx(W,{label:x.status,color:Z(x.status),size:"small"})]}),e.jsxs(s,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"Start Time:"})," ",f(j(x.start_time),"PPpp")]}),e.jsxs(s,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"End Time:"})," ",f(j(x.end_time),"PPpp")]}),e.jsxs(s,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"Created:"})," ",f(j(x.created_at),"PPpp")]}),e.jsx(s,{variant:"body2",children:e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Duration:"}),(()=>{const t=new Date(x.start_time);let a=new Date(x.end_time).getTime()-t.getTime();const n=Math.floor(a/(1e3*60*60));a-=n*(1e3*60*60);const m=Math.floor(a/(1e3*60));return`${n} hour(s), ${m} minute(s)`})()]})}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Attendees:"})," ",x.attendees]})]}),e.jsx(s,{variant:"h6",gutterBottom:!0,children:"User Information"}),e.jsxs(i,{sx:{mb:3},children:[e.jsxs(s,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"Email:"})," ",x.users?.email]}),e.jsxs(s,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"Department:"})," ",x.users?.department]}),e.jsxs(s,{variant:"body2",gutterBottom:!0,children:[e.jsx("strong",{children:"Role:"})," ",x.users?.role]})]}),e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Purpose"}),e.jsx(s,{variant:"body2",children:x.purpose})]})]})}),e.jsxs(oe,{children:[e.jsx(p,{onClick:()=>X(!1),children:"Close"}),x.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(p,{color:"success",variant:"contained",onClick:()=>{fe("approve"),z(!0)},children:"Approve"}),e.jsx(p,{color:"error",variant:"contained",onClick:()=>{fe("deny"),z(!0)},children:"Deny"}),e.jsx(p,{color:"info",variant:"contained",onClick:()=>{Ue(x.id,"completed")},children:"Mark as Completed"})]})]})]})}),e.jsxs(ae,{open:pt,onClose:()=>q(!1),children:[e.jsx(ne,{children:I==="approve"?"Approve Reservation":"Deny Reservation"}),e.jsx(ie,{children:e.jsxs(s,{children:["Are you sure you want to ",I," this reservation?",I==="approve"?" The equipment will be reserved for the requested time slot.":" The user will be notified that their request was denied."]})}),e.jsxs(oe,{children:[e.jsx(p,{onClick:()=>q(!1),children:"Cancel"}),e.jsx(p,{color:I==="approve"?"success":"error",variant:"contained",onClick:()=>{c&&I&&Me(c.id,I==="approve"?"approved":"denied")},children:I==="approve"?"Approve":"Deny"})]})]}),e.jsxs(ae,{open:gt,onClose:()=>z(!1),children:[e.jsx(ne,{children:B==="approve"?"Approve Reservation":"Deny Reservation"}),e.jsx(ie,{children:e.jsxs(s,{children:["Are you sure you want to ",B," this lab reservation?",B==="approve"?" The lab  will be reserved for the requested time slot.":" The user will be notified that their request was denied."]})}),e.jsxs(oe,{children:[e.jsx(p,{onClick:()=>z(!1),children:"Cancel"}),e.jsx(p,{color:B==="approve"?"success":"error",variant:"contained",onClick:()=>{x&&B&&Ue(x.id,B==="approve"?"approved":"denied")},children:B==="approve"?"Approve":"Deny"})]})]})]})}export{Ot as default};
//# sourceMappingURL=ReservationManagement-CkVlNk6j.js.map
