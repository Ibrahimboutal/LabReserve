import{r as a,s as h,E as wt,H as Te,J as ke,j as e,C as X,B as r,K as rt,L as I,T as c,a as u,A as Me,P as U,k as z,n as St,o as Dt,N as qt,G as d,F as C,I as _,S as w,M as l,O as Lt,p as Tt,t as kt,Q as L,v as Ee,w as Pe,x as Mt,y as T,b as Et,c as Pt,d as Wt,e as Y,f as o,g as zt,R as $t,U as Ft,V as It,W as Ut,D as We,h as ze,i as $e,l as Fe,z as At}from"./index-z-43rxTh.js";import{d as Nt}from"./Delete-CbxsixXQ.js";import{d as Ie}from"./Add-DVotoReZ.js";import{i as Z,a as Ht}from"./isToday-CCB4hpkQ.js";import{P as Ue}from"./Pagination-CFTubQZq.js";import"./LastPage-9l3JZRRp.js";function A(Ne){const{children:He,value:N,index:B,...ee}=Ne;return e.jsx("div",{role:"tabpanel",hidden:N!==B,id:`maintenance-tabpanel-${B}`,"aria-labelledby":`maintenance-tab-${B}`,...ee,children:N===B&&e.jsx(r,{sx:{pt:3},children:He})})}const Ae=["Routine Inspection","Calibration","Repair","Preventive Maintenance","Software Update","Hardware Update","Safety Check"];function qs(){const[Ne,He]=a.useState([]),[N,B]=a.useState([]),[ee,Ot]=a.useState([]),[ue,Vt]=a.useState([]),[Oe,Bt]=a.useState([]),[te,se]=a.useState(!0),[he,ne]=a.useState(null),[Gt,xe]=a.useState(!1),[$,Ve]=a.useState(null),[G,Rt]=a.useState(null),[Qt,me]=a.useState(!1),[Be,lt]=a.useState(""),[i,k]=a.useState({lab_id:"",scheduled_date:"",type:"",description:"",status:"scheduled",technician_notes:""}),[ae,F]=a.useState(!0),[pe,S]=a.useState(null),[Jt,je]=a.useState(!1),[Kt,fe]=a.useState(!1),[g,Ge]=a.useState(null),[H,Xt]=a.useState(null),[M,Re]=a.useState(""),[ie,ct]=a.useState(""),[re,dt]=a.useState(""),[O,Qe]=a.useState(""),[E,Je]=a.useState(""),[be,Yt]=a.useState(""),[Ke,Zt]=a.useState(""),[le,es]=a.useState(""),[Xe,ts]=a.useState(!1),[Ye,ot]=a.useState(!1),[ge,ss]=a.useState(0),[Ze,ns]=a.useState(0),[ye,as]=a.useState(0),[ve,is]=a.useState(1),[Ce,rs]=a.useState(1),[ut,R]=a.useState(!1),[ht,ce]=a.useState(""),Q=6,[n,q]=a.useState({equipment_id:"",scheduled_date:"",type:"",description:"",status:"scheduled",units:0,technician_notes:""});a.useEffect(()=>{et(),tt(),ls()},[]);const ls=async()=>{try{const{data:t,error:s}=await h.from("users").select("*");if(s)throw s;He(t)}catch(t){console.error("Error fetching users:",t.message)}},et=async()=>{try{F(!0);const[t,s]=await Promise.all([h.from("maintenance_schedules").select(`
            *,
            equipment (
              id,
              name,
              category,
              manufacturer,
              model,
              quantity,
              status
            )
          `).order("scheduled_date",{ascending:!0}),h.from("equipment").select("*").order("name")]);if(t.error)throw t.error;if(s.error)throw s.error;B(t.data),Ot(s.data)}catch(t){S(t.message)}finally{F(!1)}},tt=async()=>{try{se(!0);const[t,s]=await Promise.all([h.from("lab_maintenance_schedules").select(`
            *,
            lab (
              id,
              name,
              location
            )
          `).order("scheduled_date",{ascending:!0}),h.from("lab").select("*").order("name")]);if(t.error)throw t.error;if(s.error)throw s.error;Vt(t.data),Bt(s.data)}catch(t){ne(t.message)}finally{se(!1)}},J=t=>{t?(k({lab_id:t.lab_id,scheduled_date:t.scheduled_date.split("T")[0],type:t.type,description:t.description,status:t.status,technician_notes:t.technician_notes||""}),Ve(t)):(k({lab_id:"",scheduled_date:L(new Date,"yyyy-MM-dd'T'HH:mm"),type:"",description:"",status:"scheduled",technician_notes:""}),Ve(null)),xe(!0)},xt=t=>{Rt(t),me(!0)},cs=async()=>{if(G)try{F(!0);const{error:t}=await h.from("lab_maintenance_schedules").delete().eq("id",G.id);if(t)throw t;ce("Lab maintenance schedule deleted successfully"),R(!0),tt()}catch(t){S(t.message)}finally{F(!1),me(!1)}},st=async(t,s,p,j)=>{try{const{error:m}=await h.from("notifications").insert(Ne.map(x=>({id:crypto.randomUUID(),user_id:x.id,created_by:t,title:s,message:p,type:j,read:!1,created_at:new Date().toISOString()})));if(m)throw m}catch(m){console.error("Error sending notifications:",m.message)}},mt=async t=>{if(t.preventDefault(),se(!0),ne(null),!i.lab_id||!i.scheduled_date||!i.type){ne("Please fill in all required fields"),se(!1);return}try{const{data:s,error:p}=await h.from("lab").select("status").eq("id",i.lab_id).single();if(p)throw p;if(!s)throw new Error("Lab not found");if(!$){if(s.status==="occupied")throw new Error("Lab is currently occupied and cannot be scheduled for maintenance");if(s.status==="maintenance")throw new Error("Lab is already under maintenance");if(s.status!=="available")throw new Error("Lab is not available for maintenance")}let j;if($?(j=await h.from("lab_maintenance_schedules").update(i).eq("id",$.id).single(),i.status==="in_progress"?await h.from("lab").update({status:"maintenance"}).eq("id",i.lab_id):["completed","cancelled"].includes(i.status)&&await h.from("lab").update({status:"available"}).eq("id",i.lab_id)):(j=await h.from("lab_maintenance_schedules").insert([i]).single(),i.status==="in_progress"&&await h.from("lab").update({status:"maintenance"}).eq("id",i.lab_id)),j.error)throw j.error;const m=Oe.find(Le=>Le.id===i.lab_id),x=$?"updated":"scheduled",f="System",b=`Lab Maintenance ${x.charAt(0).toUpperCase()+x.slice(1)}: ${m?.name}`;let y=`Maintenance for lab "${m?.name}" has been ${x}. `;y+=`Status: ${i.status}. `,y+=`Type: ${i.type}.`,y+=`Description: ${i.description}.`,y+=`Scheduled for: ${i.scheduled_date}.`,i.status==="in_progress"?y+=" The lab is now under maintenance.":i.status==="completed"?y+=" The maintenance has been completed.":i.status==="cancelled"&&(y+=" The maintenance has been cancelled."),await st(f,b,y,"warning"),xe(!1),ce($?"Lab maintenance schedule updated successfully":"Lab maintenance schedule created successfully"),R(!0),tt()}catch(s){ne(s.message||"Failed to save lab maintenance schedule"),console.error("Error:",s)}finally{se(!1)}},K=t=>{if(t&&(t.status==="completed"||t.status==="cancelled")){S("Cannot edit a completed or cancelled maintenance schedule");return}t?(q({equipment_id:t.equipment_id,scheduled_date:t.scheduled_date.split("T")[0],type:t.type,description:t.description,status:t.status,units:t.units,technician_notes:t.technician_notes||""}),Ge(t)):(q({equipment_id:"",scheduled_date:L(new Date,"yyyy-MM-dd'T'HH:mm"),type:"",description:"",status:"scheduled",units:0,technician_notes:""}),Ge(null)),je(!0)},pt=t=>{Xt(t),fe(!0)},ds=async()=>{if(H)try{F(!0);const{error:t}=await h.from("maintenance_schedules").delete().eq("id",H.id);if(t)throw t;ce("Maintenance schedule deleted successfully"),R(!0),et()}catch(t){S(t.message)}finally{F(!1),fe(!1)}},jt=async t=>{t.preventDefault(),F(!0),S(null);try{const{equipment_id:s,scheduled_date:p,units:j}=n;if(g&&g.status===n.status){S("No changes detected in the status");return}if(!s||!p||!j){S("Please fill in all required fields");return}if(j<=0){S("Units must be greater than 0");return}const m=new Date(p);if(isNaN(m.getTime())){S("Invalid scheduled date");return}if(m<new Date){S("Scheduled date cannot be in the past");return}const{data:x,error:f}=await h.from("equipment").select("quantity, units_under_maintenance").eq("id",s).single();if(f)throw f;const{quantity:b,units_under_maintenance:y}=x,Le=new Date(p),fs=new Date(Le.getTime()+1*60*60*1e3),{data:bs,error:vt}=await h.from("reservations").select("*").eq("equipment_id",s).in("status",["approved","pending"]).or(`start_time.lte.${fs.toISOString()},end_time.gte.${Le.toISOString()}`);if(vt)throw vt;const gs=bs.reduce((P,D)=>P+D.quantity,0);let nt=y;if(g){const P=g.units;nt-=P}const Ct=b-gs-nt;if(j>Ct)throw new Error(`Not enough available units. Requested: ${j}, Available: ${Ct}`);const _t={...n,completed_at:n.status==="completed"?new Date().toISOString():null};if(g){const{error:P}=await h.from("maintenance_schedules").update(_t).eq("id",g.id);if(P)throw P;const D=g.units;let v=nt;n.status==="completed"||n.status==="cancelled"?v-=D:n.status===g.status?v+=n.units-D:((g.status==="completed"||g.status==="cancelled")&&(v+=D),(n.status==="in_progress"||n.status==="scheduled")&&(v=Math.max(v,n.units))),v=Math.max(0,Math.min(v,b));let de="operational";v===b&&(de="maintenance");const{error:oe}=await h.from("equipment").update({units_under_maintenance:v,status:de}).eq("id",s);if(oe)throw oe;const V=ee.find(ys=>ys.id===n.equipment_id),at="System",it=`Maintenance Schedule Updated: ${V?.name}`;let W=`The maintenance schedule for "${V?.name}" has been updated to "${n.status}".`;n.status==="in_progress"?W+=` "${V?.units_under_maintenance}" units of this equipment are now under maintenance.`:n.status==="completed"?W+=` The maintenance has been completed and "${V?.units_under_maintenance}" units of this equipment are now available for reservations.`:n.status==="cancelled"&&(W+=` The maintenance has been cancelled and "${V?.units_under_maintenance}" units of this equipment are now available for reservations.`),W+=`Type: ${n.type}.`,W+=`Description: ${n.description}.`,W+=`Scheduled for: ${n.scheduled_date}.`,await st(at,it,W,"Warning"),ce("Maintenance schedule updated successfully")}else{const{error:P}=await h.from("maintenance_schedules").insert([_t]);if(P)throw P;let D=y+n.units;D=Math.min(D,b);let v="operational";D===b&&(v="maintenance");const{error:de}=await h.from("equipment").update({units_under_maintenance:D,status:v}).eq("id",s);if(de)throw de;ce("Maintenance scheduled successfully");const oe=ee.find(W=>W.id===n.equipment_id),V="System",at=`New Maintenance Scheduled: ${oe?.name}`,it=`A new maintenance schedule has been created for "${oe?.name}" with "${n.units}" units, scheduled for "${n.scheduled_date}", Type "${n.type}".`;await st(V,at,it,"Warning")}je(!1),R(!0),et()}catch(s){S(s.message)}finally{F(!1)}},_e=t=>{switch(t){case"scheduled":return"primary";case"in_progress":return"warning";case"completed":return"success";case"cancelled":return"error";default:return"default"}},os=(t,s)=>{ss(s)},us=(t,s)=>{ns(s)},hs=(t,s)=>{as(s)},ft=(t,s)=>{is(s)},bt=(t,s)=>{rs(s)},xs=t=>{const s=N.find(p=>p.id===t.event.id);s&&K(s)},ms=t=>{const s=ue.find(p=>p.id===t.event.id);s&&J(s)},we=N.filter(t=>{const s=t.equipment?.name?.toLowerCase().includes(M.toLowerCase())||t.description?.toLowerCase().includes(M.toLowerCase())||t.type?.toLowerCase().includes(M.toLowerCase())||t.units.toString().includes(M.toLowerCase()),p=!ie||t.status===ie,j=!O||t.type===O;let m=!0;const x=wt(t.scheduled_date),f=new Date;if(E==="today")m=Z(x);else if(E==="upcoming")m=Te(x,f);else if(E==="past")m=ke(x,f);else if(E==="thisWeek"){const b=Ht(f,7);m=Te(x,f)&&ke(x,b)}return s&&p&&j&&m}),Se=ue.filter(t=>{const s=t.lab?.name?.toLowerCase().includes(be.toLowerCase())||t.description?.toLowerCase().includes(be.toLowerCase())||t.type?.toLowerCase().includes(be.toLowerCase()),p=!Be||t.lab_id===Be,j=!re||t.status===re,m=!Ke||t.type===Ke;let x=!0;const f=wt(t.scheduled_date),b=new Date;if(le==="today")x=Z(f);else if(le==="upcoming")x=Te(f,b);else if(le==="past")x=ke(f,b);else if(le==="thisWeek"){const y=Ht(b,7);x=Te(f,b)&&ke(f,y)}return s&&p&&j&&m&&x}),De=Math.ceil(we.length/Q),qe=Math.ceil(Se.length/Q),gt=we.slice((ve-1)*Q,ve*Q),yt=Se.slice((Ce-1)*Q,Ce*Q),ps=N.map(t=>({id:t.id,title:`${t.type}: ${t.equipment?.name}`,start:t.scheduled_date,backgroundColor:t.status==="completed"?"#4caf50":t.status==="in_progress"?"#ff9800":t.status==="cancelled"?"#f44336":"#2196f3",borderColor:t.status==="completed"?"#2e7d32":t.status==="in_progress"?"#e65100":t.status==="cancelled"?"#c62828":"#1565c0",extendedProps:{status:t.status,description:t.description,equipment:t.equipment}})),js=ue.map(t=>({id:t.id,title:`${t.type}: ${t.lab?.name}`,start:t.scheduled_date,backgroundColor:t.status==="completed"?"#4caf50":t.status==="in_progress"?"#ff9800":t.status==="cancelled"?"#f44336":"#2196f3",borderColor:t.status==="completed"?"#2e7d32":t.status==="in_progress"?"#e65100":t.status==="cancelled"?"#c62828":"#1565c0",extendedProps:{status:t.status,description:t.description,equipment:t.lab}}));return ae&&N.length===0?e.jsx(X,{}):te&&ue.length===0?e.jsx(X,{}):e.jsx(r,{children:e.jsxs(r,{children:[e.jsx(r,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(rt,{value:Ze,onChange:us,"aria-label":"maintenance view tabs",children:[e.jsx(I,{label:"Lab Maintenance Scheduling"}),e.jsx(I,{label:"Maintenance Scheduling"})]})}),e.jsxs(A,{value:Ze,index:0,children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(c,{variant:"h5",fontWeight:"bold",children:"Lab Maintenance Scheduling"}),e.jsx(u,{variant:"contained",color:"primary",startIcon:e.jsx(Ie,{}),onClick:()=>J(),children:"Schedule Lab Maintenance"})]}),he&&e.jsx(Me,{severity:"error",sx:{mb:3},onClose:()=>ne(null),children:he}),e.jsxs(U,{sx:{p:2,mb:3},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(z,{placeholder:"Search lab maintenance schedules...",variant:"outlined",size:"small",value:be,onChange:t=>Yt(t.target.value),InputProps:{startAdornment:e.jsx(St,{position:"start",children:e.jsx(Dt,{})})},sx:{width:300}}),e.jsx(u,{variant:"outlined",startIcon:e.jsx(qt,{}),onClick:()=>ot(!Ye),size:"small",children:Ye?"Hide Lab Filters":"Show Lab Filters"})]}),Ye&&e.jsxs(r,{sx:{mt:2},children:[e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,sm:3,children:e.jsxs(C,{fullWidth:!0,size:"small",children:[e.jsx(_,{children:"Lab"}),e.jsxs(w,{value:Be,label:"Lab",onChange:t=>lt(t.target.value),children:[e.jsx(l,{value:"",children:"All Lab"}),Oe.map(t=>e.jsx(l,{value:t.id,children:t.name},t.id))]})]})}),e.jsx(d,{item:!0,xs:12,sm:3,children:e.jsxs(C,{fullWidth:!0,size:"small",children:[e.jsx(_,{children:"Status"}),e.jsxs(w,{value:re,label:"Status",onChange:t=>dt(t.target.value),children:[e.jsx(l,{value:"",children:"All"}),e.jsx(l,{value:"scheduled",children:"Scheduled"}),e.jsx(l,{value:"in_progress",children:"In Progress"}),e.jsx(l,{value:"completed",children:"Completed"}),e.jsx(l,{value:"cancelled",children:"Cancelled"})]})]})}),e.jsx(d,{item:!0,xs:12,sm:3,children:e.jsxs(C,{fullWidth:!0,size:"small",children:[e.jsx(_,{children:"Type"}),e.jsxs(w,{value:Ke,label:"Type",onChange:t=>Zt(t.target.value),children:[e.jsx(l,{value:"",children:"All Types"}),Ae.map(t=>e.jsx(l,{value:t,children:t},t))]})]})}),e.jsx(d,{item:!0,xs:12,sm:3,children:e.jsxs(C,{fullWidth:!0,size:"small",children:[e.jsx(_,{children:"Date"}),e.jsxs(w,{value:le,label:"Date",onChange:t=>es(t.target.value),children:[e.jsx(l,{value:"",children:"All Dates"}),e.jsx(l,{value:"today",children:"Today"}),e.jsx(l,{value:"upcoming",children:"Upcoming"}),e.jsx(l,{value:"thisWeek",children:"This Week"}),e.jsx(l,{value:"past",children:"Past"})]})]})})]}),e.jsx(r,{sx:{mt:2,display:"flex",justifyContent:"flex-end"},children:e.jsx(u,{variant:"text",color:"secondary",size:"small",onClick:()=>{Re(""),lt(""),dt(""),Qe(""),Je(""),ot(!1)},children:"Clear Lab Filters"})})]})]}),e.jsx(r,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(rt,{value:ye,onChange:hs,"aria-label":"lab maintenance view tabs",children:[e.jsx(I,{label:"Lab Grid View"}),e.jsx(I,{label:"Lab Table View"}),e.jsx(I,{label:"Lab Calendar View",icon:e.jsx(Lt,{}),iconPosition:"start"})]})}),e.jsxs(A,{value:ye,index:0,children:[e.jsx(d,{container:!0,spacing:3,children:Se.length>0?yt.map(t=>e.jsx(d,{item:!0,xs:12,sm:6,md:4,children:e.jsx(Tt,{sx:{height:"100%"},children:e.jsxs(kt,{children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:t.lab?.name}),e.jsxs(r,{children:[e.jsx(Ee,{title:"Edit",children:e.jsx(Pe,{size:"small",onClick:()=>J(t),sx:{mr:1},children:e.jsx(Mt,{fontSize:"small"})})}),e.jsx(Ee,{title:"Delete",children:e.jsx(Pe,{size:"small",color:"error",onClick:()=>xt(t),children:e.jsx(Nt,{fontSize:"small"})})})]})]}),e.jsxs(r,{sx:{mb:2},children:[e.jsx(T,{label:t.type,size:"small",sx:{mr:1,mb:1}}),e.jsx(T,{label:t.status,color:_e(t.status),size:"small",sx:{mb:1}})]}),e.jsx(r,{component:"span",fontWeight:"medium",children:"Scheduled:"})," ",L(new Date(t.scheduled_date),"PPp"),Z(new Date(t.scheduled_date))&&e.jsx(T,{label:"Today",color:"error",size:"small",sx:{ml:1}}),e.jsx(c,{variant:"body2",paragraph:!0,children:t.description}),t.technician_notes&&e.jsxs(r,{sx:{mt:1},children:[e.jsx(c,{variant:"body2",color:"text.secondary",fontWeight:"medium",children:"Notes:"}),e.jsx(c,{variant:"body2",color:"text.secondary",children:t.technician_notes})]}),e.jsx(r,{sx:{mt:2},children:e.jsx(u,{size:"small",variant:"outlined",onClick:()=>J(t),children:"Update Status"})})]})})},t.id)):e.jsx(d,{item:!0,xs:12,children:e.jsxs(U,{sx:{p:3,textAlign:"center"},children:[e.jsx(c,{variant:"h6",children:"No Labmaintenance schedules found"}),e.jsx(c,{variant:"body1",color:"text.secondary",paragraph:!0,children:M||re||O||E?"Try adjusting your search or filter criteria":"No Lab maintenance schedules have been created yet"}),!M&&!re&&!O&&!E&&e.jsx(u,{variant:"contained",startIcon:e.jsx(Ie,{}),onClick:()=>J(),sx:{mt:2},children:"Schedule Lab Maintenance"})]})})}),qe>1&&e.jsx(r,{sx:{display:"flex",justifyContent:"center",mt:3},children:e.jsx(Ue,{count:qe,page:Ce,onChange:bt,color:"primary"})})]}),e.jsxs(A,{value:ye,index:1,children:[e.jsx(Et,{component:U,children:e.jsxs(Pt,{children:[e.jsx(Wt,{children:e.jsxs(Y,{children:[e.jsx(o,{children:"Lab"}),e.jsx(o,{children:"Type"}),e.jsx(o,{children:"Scheduled Date"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Actions"})]})}),e.jsx(zt,{children:Se.length>0?yt.map(t=>e.jsxs(Y,{children:[e.jsxs(o,{children:[e.jsx(c,{variant:"body2",fontWeight:"medium",children:t.lab?.name}),e.jsx(c,{variant:"caption",color:"text.secondary",children:t.lab?.location})]}),e.jsx(o,{children:t.type}),e.jsxs(o,{children:[L(new Date(t.scheduled_date),"PPp"),Z(new Date(t.scheduled_date))&&e.jsx(T,{label:"Today",color:"error",size:"small",sx:{ml:1}})]}),e.jsx(o,{children:e.jsx(T,{label:t.status,color:_e(t.status),size:"small"})}),e.jsx(o,{children:e.jsxs(r,{sx:{display:"flex",gap:1},children:[e.jsx(u,{size:"small",variant:"outlined",onClick:()=>J(t),children:"Edit"}),e.jsx(u,{size:"small",variant:"outlined",color:"error",onClick:()=>xt(t),children:"Delete"})]})})]},t.id)):e.jsx(Y,{children:e.jsxs(o,{colSpan:5,align:"center",children:[e.jsx(c,{variant:"subtitle1",sx:{py:2},children:"No Lab maintenance schedules found"}),e.jsx(c,{variant:"body2",color:"text.secondary",children:"Try adjusting your search or filter criteria"})]})})})]})}),qe>1&&e.jsx(r,{sx:{display:"flex",justifyContent:"center",mt:3},children:e.jsx(Ue,{count:qe,page:Ce,onChange:bt,color:"primary"})})]}),e.jsx(A,{value:ye,index:2,children:e.jsx(U,{sx:{p:2},children:e.jsx($t,{plugins:[Ft,It,Ut],initialView:"dayGridMonth",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},events:js,eventClick:ms,height:"auto",aspectRatio:1.5})})}),e.jsxs(We,{open:Gt,onClose:()=>{xe(!1),k({lab_id:"",scheduled_date:L(new Date,"yyyy-MM-dd'T'HH:mm"),type:"",description:"",status:"scheduled",technician_notes:""}),Ve(null)},maxWidth:"sm",fullWidth:!0,children:[e.jsx(ze,{children:$?"Update Lab Maintenance Schedule":"Lab Schedule Maintenance"}),e.jsxs($e,{children:[he&&e.jsx(Me,{severity:"error",sx:{mb:2},children:he}),e.jsx("form",{onSubmit:mt,children:e.jsxs(d,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(d,{item:!0,xs:12,children:e.jsxs(C,{fullWidth:!0,required:!0,children:[e.jsx(_,{children:"Lab"}),e.jsx(w,{value:i.lab_id,label:"Lab",onChange:t=>k({...i,lab_id:t.target.value}),children:Oe.map(t=>e.jsxs(l,{value:t.id,children:[t.name," (",t.location,")"]},t.id))})]})}),e.jsx(d,{item:!0,xs:12,children:e.jsxs(C,{fullWidth:!0,required:!0,children:[e.jsx(_,{children:"Maintenance Type"}),e.jsx(w,{value:i.type,label:"Maintenance Type",onChange:t=>k({...i,type:t.target.value}),children:Ae.map(t=>e.jsx(l,{value:t,children:t},t))})]})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(z,{type:"datetime-local",label:"Scheduled Date",fullWidth:!0,required:!0,value:i.scheduled_date,onChange:t=>k({...i,scheduled_date:t.target.value}),InputLabelProps:{shrink:!0}})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(z,{label:"Description",fullWidth:!0,multiline:!0,rows:3,value:i.description,onChange:t=>k({...i,description:t.target.value}),placeholder:"Describe the maintenance to be performed"})}),$&&e.jsxs(e.Fragment,{children:[e.jsx(d,{item:!0,xs:12,children:e.jsxs(C,{fullWidth:!0,required:!0,children:[e.jsx(_,{children:"Status"}),e.jsxs(w,{value:i.status,label:"Status",onChange:t=>k({...i,status:t.target.value}),children:[e.jsx(l,{value:i.status,disabled:!0,children:i.status.charAt(0).toUpperCase()+i.status.slice(1).replace("_"," ")}),["scheduled","in_progress","completed","cancelled"].filter(t=>t!==i.status).map(t=>e.jsx(l,{value:t,children:t.charAt(0).toUpperCase()+t.slice(1).replace("_"," ")},t))]})]})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(z,{label:"Technician Notes",fullWidth:!0,multiline:!0,rows:3,value:i.technician_notes,onChange:t=>k({...i,technician_notes:t.target.value}),placeholder:"Add notes about the maintenance performed or issues encountered"})})]})]})})]}),e.jsxs(Fe,{children:[e.jsx(u,{onClick:()=>xe(!1),children:"Cancel"}),e.jsx(u,{onClick:mt,color:"primary",variant:"contained",disabled:te,children:te?e.jsx(X,{size:24}):$?"Update":"Schedule"})]})]}),e.jsxs(We,{open:Qt,onClose:()=>me(!1),children:[e.jsx(ze,{children:"Confirm Deletion"}),e.jsxs($e,{children:[e.jsxs(c,{children:['Are you sure you want to delete this lab maintenance schedule for "',G?.lab?.name,'"?']}),G&&e.jsxs(r,{sx:{mt:2},children:[e.jsxs(c,{variant:"body2",children:[e.jsx("strong",{children:"Scheduled Date:"})," ",L(new Date(G.scheduled_date),"PPp")]}),e.jsxs(c,{variant:"body2",children:[e.jsx("strong",{children:"Status:"})," ",G.status]})]})]}),e.jsxs(Fe,{children:[e.jsx(u,{onClick:()=>me(!1),children:"Cancel"}),e.jsx(u,{onClick:cs,color:"error",variant:"contained",disabled:te,children:te?e.jsx(X,{size:24}):"Delete"})]})]}),e.jsx(At,{open:ut,autoHideDuration:6e3,onClose:()=>R(!1),message:ht})]}),e.jsxs(A,{value:Ze,index:1,children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(c,{variant:"h5",fontWeight:"bold",children:"Maintenance Scheduling"}),e.jsx(u,{variant:"contained",color:"primary",startIcon:e.jsx(Ie,{}),onClick:()=>K(),children:"Schedule Equipment Maintenance"})]}),pe&&e.jsx(Me,{severity:"error",sx:{mb:3},onClose:()=>S(null),children:pe}),e.jsxs(U,{sx:{p:2,mb:3},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(z,{placeholder:"Search maintenance schedules...",variant:"outlined",size:"small",value:M,onChange:t=>Re(t.target.value),InputProps:{startAdornment:e.jsx(St,{position:"start",children:e.jsx(Dt,{})})},sx:{width:300}}),e.jsx(u,{variant:"outlined",startIcon:e.jsx(qt,{}),onClick:()=>ts(!Xe),size:"small",children:Xe?"Hide Filters":"Show Filters"})]}),Xe&&e.jsxs(r,{sx:{mt:2},children:[e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,sm:4,children:e.jsxs(C,{fullWidth:!0,size:"small",children:[e.jsx(_,{children:"Status"}),e.jsxs(w,{value:ie,label:"Status",onChange:t=>ct(t.target.value),children:[e.jsx(l,{value:"",children:"All Statuses"}),e.jsx(l,{value:"scheduled",children:"Scheduled"}),e.jsx(l,{value:"in_progress",children:"In Progress"}),e.jsx(l,{value:"completed",children:"Completed"}),e.jsx(l,{value:"cancelled",children:"Cancelled"})]})]})}),e.jsx(d,{item:!0,xs:12,sm:4,children:e.jsxs(C,{fullWidth:!0,size:"small",children:[e.jsx(_,{children:"Type"}),e.jsxs(w,{value:O,label:"Type",onChange:t=>Qe(t.target.value),children:[e.jsx(l,{value:"",children:"All Types"}),Ae.map(t=>e.jsx(l,{value:t,children:t},t))]})]})}),e.jsx(d,{item:!0,xs:12,sm:4,children:e.jsxs(C,{fullWidth:!0,size:"small",children:[e.jsx(_,{children:"Date"}),e.jsxs(w,{value:E,label:"Date",onChange:t=>Je(t.target.value),children:[e.jsx(l,{value:"",children:"All Dates"}),e.jsx(l,{value:"today",children:"Today"}),e.jsx(l,{value:"upcoming",children:"Upcoming"}),e.jsx(l,{value:"thisWeek",children:"This Week"}),e.jsx(l,{value:"past",children:"Past"})]})]})})]}),e.jsx(r,{sx:{mt:2,display:"flex",justifyContent:"flex-end"},children:e.jsx(u,{variant:"text",color:"secondary",size:"small",onClick:()=>{Re(""),ct(""),Qe(""),Je("")},children:"Clear Filters"})})]})]}),e.jsx(r,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(rt,{value:ge,onChange:os,"aria-label":"maintenance view tabs",children:[e.jsx(I,{label:"Grid View"}),e.jsx(I,{label:"Table View"}),e.jsx(I,{label:"Calendar View",icon:e.jsx(Lt,{}),iconPosition:"start"})]})}),e.jsxs(A,{value:ge,index:0,children:[e.jsx(d,{container:!0,spacing:3,children:we.length>0?gt.map(t=>e.jsx(d,{item:!0,xs:12,sm:6,md:4,children:e.jsx(Tt,{sx:{height:"100%"},children:e.jsxs(kt,{children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:t.equipment?.name}),e.jsxs(r,{children:[e.jsx(Ee,{title:"Edit",children:e.jsx(Pe,{size:"small",onClick:()=>K(t),sx:{mr:1},children:e.jsx(Mt,{fontSize:"small"})})}),e.jsx(Ee,{title:"Delete",children:e.jsx(Pe,{size:"small",color:"error",onClick:()=>pt(t),children:e.jsx(Nt,{fontSize:"small"})})})]})]}),e.jsxs(r,{sx:{mb:2},children:[e.jsx(T,{label:t.type,size:"small",sx:{mr:1,mb:1}}),e.jsx(T,{label:t.status,color:_e(t.status),size:"small",sx:{mb:1}})]}),e.jsx(r,{sx:{mb:1},children:e.jsxs(c,{variant:"body2",color:"text.secondary",children:[e.jsx(r,{component:"span",fontWeight:"medium",children:"Quantity:"})," ",t.units]})}),e.jsx(r,{component:"span",fontWeight:"medium",children:"Scheduled:"})," ",L(new Date(t.scheduled_date),"PPp"),Z(new Date(t.scheduled_date))&&e.jsx(T,{label:"Today",color:"error",size:"small",sx:{ml:1}}),e.jsx(c,{variant:"body2",paragraph:!0,children:t.description}),t.technician_notes&&e.jsxs(r,{sx:{mt:1},children:[e.jsx(c,{variant:"body2",color:"text.secondary",fontWeight:"medium",children:"Notes:"}),e.jsx(c,{variant:"body2",color:"text.secondary",children:t.technician_notes})]}),e.jsx(r,{sx:{mt:2},children:e.jsx(u,{size:"small",variant:"outlined",onClick:()=>K(t),children:"Update Status"})})]})})},t.id)):e.jsx(d,{item:!0,xs:12,children:e.jsxs(U,{sx:{p:3,textAlign:"center"},children:[e.jsx(c,{variant:"h6",children:"No Equipment maintenance schedules found"}),e.jsx(c,{variant:"body1",color:"text.secondary",paragraph:!0,children:M||ie||O||E?"Try adjusting your search or filter criteria":"No Equipment maintenance schedules have been created yet"}),!M&&!ie&&!O&&!E&&e.jsx(u,{variant:"contained",startIcon:e.jsx(Ie,{}),onClick:()=>K(),sx:{mt:2},children:"Schedule Maintenance"})]})})}),De>1&&e.jsx(r,{sx:{display:"flex",justifyContent:"center",mt:3},children:e.jsx(Ue,{count:De,page:ve,onChange:ft,color:"primary"})})]}),e.jsxs(A,{value:ge,index:1,children:[e.jsx(Et,{component:U,children:e.jsxs(Pt,{children:[e.jsx(Wt,{children:e.jsxs(Y,{children:[e.jsx(o,{children:"Equipment"}),e.jsx(o,{children:"Type"}),e.jsx(o,{children:"Scheduled Date"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Units"}),e.jsx(o,{children:"Actions"})]})}),e.jsx(zt,{children:we.length>0?gt.map(t=>e.jsxs(Y,{children:[e.jsxs(o,{children:[e.jsx(c,{variant:"body2",fontWeight:"medium",children:t.equipment?.name}),e.jsx(c,{variant:"caption",color:"text.secondary",children:t.equipment?.category})]}),e.jsx(o,{children:t.type}),e.jsxs(o,{children:[L(new Date(t.scheduled_date),"PPp"),Z(new Date(t.scheduled_date))&&e.jsx(T,{label:"Today",color:"error",size:"small",sx:{ml:1}})]}),e.jsx(o,{children:e.jsx(T,{label:t.status,color:_e(t.status),size:"small"})}),e.jsx(o,{children:t.units}),e.jsx(o,{children:e.jsxs(r,{sx:{display:"flex",gap:1},children:[e.jsx(u,{size:"small",variant:"outlined",onClick:()=>K(t),children:"Edit"}),e.jsx(u,{size:"small",variant:"outlined",color:"error",onClick:()=>pt(t),children:"Delete"})]})})]},t.id)):e.jsx(Y,{children:e.jsxs(o,{colSpan:5,align:"center",children:[e.jsx(c,{variant:"subtitle1",sx:{py:2},children:"No EQUIPMENT maintenance schedules found"}),e.jsx(c,{variant:"body2",color:"text.secondary",children:"Try adjusting your search or filter criteria"})]})})})]})}),De>1&&e.jsx(r,{sx:{display:"flex",justifyContent:"center",mt:3},children:e.jsx(Ue,{count:De,page:ve,onChange:ft,color:"primary"})})]}),e.jsx(A,{value:ge,index:2,children:e.jsx(U,{sx:{p:2},children:e.jsx($t,{plugins:[Ft,It,Ut],initialView:"dayGridMonth",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},events:ps,eventClick:xs,height:"auto",aspectRatio:1.5})})}),e.jsxs(We,{open:Jt,onClose:()=>{je(!1),q({equipment_id:"",scheduled_date:L(new Date,"yyyy-MM-dd'T'HH:mm"),type:"",description:"",status:"scheduled",units:0,technician_notes:""}),Ge(null)},maxWidth:"sm",fullWidth:!0,children:[e.jsx(ze,{children:g?"Update Maintenance Schedule":"Schedule Maintenance"}),e.jsxs($e,{children:[pe&&e.jsx(Me,{severity:"error",sx:{mb:2},children:pe}),e.jsx("form",{onSubmit:jt,children:e.jsxs(d,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(d,{item:!0,xs:12,children:e.jsxs(C,{fullWidth:!0,required:!0,children:[e.jsx(_,{children:"Equipment"}),e.jsx(w,{value:n.equipment_id,label:"Equipment",onChange:t=>q({...n,equipment_id:t.target.value}),children:ee.map(t=>e.jsxs(l,{value:t.id,children:[t.name," (",t.category,") (",t.quantity," units)"]},t.id))})]})}),e.jsx(d,{item:!0,xs:12,children:e.jsxs(C,{fullWidth:!0,required:!0,children:[e.jsx(_,{children:"Maintenance Type"}),e.jsx(w,{value:n.type,label:"Maintenance Type",onChange:t=>q({...n,type:t.target.value}),children:Ae.map(t=>e.jsx(l,{value:t,children:t},t))})]})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(z,{margin:"dense",label:"How many units need to be maintained?",type:"number",fullWidth:!0,required:!0,value:n.units,onChange:t=>q({...n,units:Number(t.target.value)}),InputProps:{inputProps:{min:1}}})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(z,{type:"datetime-local",label:"Scheduled Date",fullWidth:!0,required:!0,value:n.scheduled_date,onChange:t=>q({...n,scheduled_date:t.target.value}),InputLabelProps:{shrink:!0}})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(z,{label:"Description",fullWidth:!0,multiline:!0,rows:3,value:n.description,onChange:t=>q({...n,description:t.target.value}),placeholder:"Describe the maintenance to be performed"})}),g&&e.jsxs(e.Fragment,{children:[e.jsx(d,{item:!0,xs:12,children:e.jsxs(C,{fullWidth:!0,required:!0,children:[e.jsx(_,{children:"Status"}),e.jsxs(w,{value:n.status,label:"Status",onChange:t=>q({...n,status:t.target.value}),children:[e.jsx(l,{value:n.status,disabled:!0,children:n.status.charAt(0).toUpperCase()+n.status.slice(1).replace("_"," ")}),["scheduled","in_progress","completed","cancelled"].filter(t=>t!==n.status).map(t=>e.jsx(l,{value:t,children:t.charAt(0).toUpperCase()+t.slice(1).replace("_"," ")},t))]})]})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(z,{label:"Technician Notes",fullWidth:!0,multiline:!0,rows:3,value:n.technician_notes,onChange:t=>q({...n,technician_notes:t.target.value}),placeholder:"Add notes about the maintenance performed or issues encountered"})})]})]})})]}),e.jsxs(Fe,{children:[e.jsx(u,{onClick:()=>je(!1),children:"Cancel"}),e.jsx(u,{onClick:jt,color:"primary",variant:"contained",disabled:ae,children:ae?e.jsx(X,{size:24}):g?"Update":"Schedule"})]})]}),e.jsxs(We,{open:Kt,onClose:()=>fe(!1),children:[e.jsx(ze,{children:"Confirm Deletion"}),e.jsxs($e,{children:[e.jsxs(c,{children:['Are you sure you want to delete this maintenance schedule for "',H?.equipment?.name,'"?']}),H&&e.jsxs(r,{sx:{mt:2},children:[e.jsxs(c,{variant:"body2",children:[e.jsx("strong",{children:"Type:"})," ",H.type]}),e.jsxs(c,{variant:"body2",children:[e.jsx("strong",{children:"Scheduled Date:"})," ",L(new Date(H.scheduled_date),"PPp")]}),e.jsxs(c,{variant:"body2",children:[e.jsx("strong",{children:"Status:"})," ",H.status]})]})]}),e.jsxs(Fe,{children:[e.jsx(u,{onClick:()=>fe(!1),children:"Cancel"}),e.jsx(u,{onClick:ds,color:"error",variant:"contained",disabled:ae,children:ae?e.jsx(X,{size:24}):"Delete"})]})]}),e.jsx(At,{open:ut,autoHideDuration:6e3,onClose:()=>R(!1),message:ht})]})]})})}export{qs as default};
//# sourceMappingURL=MaintenanceScheduling-2QU35oth.js.map
