import{r as t,u as P,s as m,j as e,C as O,A as z,B as y,T as F,a as n,b as I,P as N,c as H,d as $,e as S,f as l,g as G,D,h as E,i as U,k as o,M as d,l as A}from"./index-z-43rxTh.js";function K(){const[R,T]=t.useState([]),[k,q]=t.useState(!0),[x,j]=t.useState(null),[M,c]=t.useState(!1),[p,B]=t.useState(null),[f,g]=t.useState(""),{user:w}=P(),[W,u]=t.useState(!1),[a,i]=t.useState({email:"",password:"",department:"",role:"lab_manager"});t.useEffect(()=>{C()},[]);const C=async()=>{try{const{data:r,error:s}=await m.from("users").select("*").order("created_at",{ascending:!1});if(s)throw s;T(r||[])}catch(r){j(r.message)}finally{q(!1)}},_=r=>{B(r),g(r.role),c(!0)},b=async r=>{if(r.preventDefault(),!(!p||!f||!w))try{if(w.role!=="admin")throw new Error("Admin privileges required");const s=f.toLowerCase(),{data:h,error:v}=await m.from("users").update({role:s}).eq("id",p.id).select().single();if(v)throw v;if(!h)throw new Error("User not found");c(!1),C()}catch(s){j(`Update failed: ${s.message}`)}},L=async()=>{try{const{data:r,error:s}=await m.auth.signUp({email:a.email,password:a.password});if(s)throw s;if(!r.user?.id)throw new Error("No user ID returned");const{error:h}=await m.from("users").insert([{id:r.user.id,email:a.email,role:a.role,department:a.department}]);if(h)throw h;u(!1),i({email:"",password:"",department:"",role:"lab_manager"})}catch(r){console.error("Error creating staff account:",r)}};return k?e.jsx(O,{}):x?e.jsx(z,{severity:"error",children:x}):e.jsxs(y,{children:[e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[e.jsx(F,{variant:"h6",gutterBottom:!0,children:"User Management"}),e.jsx(n,{variant:"contained",color:"primary",onClick:()=>u(!0),children:"Create Staff Account"})]}),e.jsx(I,{component:N,children:e.jsxs(H,{children:[e.jsx($,{children:e.jsxs(S,{children:[e.jsx(l,{children:"Email"}),e.jsx(l,{children:"Department"}),e.jsx(l,{children:"Role"}),e.jsx(l,{children:"Actions"})]})}),e.jsx(G,{children:R.map(r=>e.jsxs(S,{children:[e.jsx(l,{children:r.email}),e.jsx(l,{children:r.department}),e.jsx(l,{children:r.role}),e.jsx(l,{children:e.jsx(n,{size:"small",onClick:()=>_(r),children:"Edit Role"})})]},r.id))})]})}),e.jsxs(D,{open:M,onClose:()=>c(!1),children:[e.jsx(E,{children:"Edit User Role"}),e.jsx(U,{children:e.jsx("form",{onSubmit:b,children:e.jsxs(o,{margin:"dense",label:"Role",select:!0,fullWidth:!0,required:!0,value:f,onChange:r=>g(r.target.value),children:[e.jsx(d,{value:"student",children:"Student"}),e.jsx(d,{value:"lab_manager",children:"Lab Manager"}),e.jsx(d,{value:"admin",children:"Admin"})]})})}),e.jsxs(A,{children:[e.jsx(n,{onClick:()=>c(!1),children:"Cancel"}),e.jsx(n,{type:"submit",onClick:b,color:"primary",children:"Update"})]})]}),e.jsxs(D,{open:W,onClose:()=>u(!1),children:[e.jsx(E,{children:"Create Staff Account"}),e.jsxs(U,{children:[e.jsx(o,{margin:"dense",label:"Email",type:"email",fullWidth:!0,required:!0,value:a.email,onChange:r=>i({...a,email:r.target.value})}),e.jsx(o,{margin:"dense",label:"Password",type:"password",fullWidth:!0,required:!0,value:a.password,onChange:r=>i({...a,password:r.target.value})}),e.jsx(o,{margin:"dense",label:"Department",fullWidth:!0,required:!0,value:a.department,onChange:r=>i({...a,department:r.target.value})}),e.jsxs(o,{margin:"dense",label:"Role",select:!0,fullWidth:!0,required:!0,value:a.role,onChange:r=>i({...a,role:r.target.value}),children:[e.jsx(d,{value:"lab_manager",children:"Lab Manager"}),e.jsx(d,{value:"admin",children:"Admin"})]})]}),e.jsxs(A,{children:[e.jsx(n,{onClick:()=>u(!1),children:"Cancel"}),e.jsx(n,{onClick:L,color:"primary",children:"Create Account"})]})]})]})}export{K as default};
//# sourceMappingURL=UserManagement-qaWFyiQb.js.map
