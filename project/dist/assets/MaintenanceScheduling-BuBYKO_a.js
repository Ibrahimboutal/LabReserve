import{r as n,s as u,E as Lt,H as Ee,J as ke,j as e,C as ee,B as i,K as dt,L as F,T as d,a as f,A as Me,P as A,k as W,n as Tt,o as Et,N as kt,G as c,F as w,I as C,S as _,M as r,O as Mt,p as Pt,t as Wt,Q as L,v as Pe,w as We,x as zt,y as T,b as It,c as Ut,d as Ft,e as te,f as m,g as At,R as $t,U as Nt,V as Ht,W as Ot,D as ze,h as Ie,i as Ue,l as Fe,z as Vt}from"./index-z-43rxTh.js";import{d as Gt}from"./Delete-CbxsixXQ.js";import{d as Ae}from"./Add-DVotoReZ.js";import{P as $e}from"./Pagination-CFTubQZq.js";import{i as se,a as Rt}from"./isToday-CCB4hpkQ.js";import"./LastPage-9l3JZRRp.js";function $(He){const{children:Oe,value:N,index:z,...ne}=He;return e.jsx("div",{role:"tabpanel",hidden:N!==z,id:`maintenance-tabpanel-${z}`,"aria-labelledby":`maintenance-tab-${z}`,...ne,children:N===z&&e.jsx(i,{sx:{pt:3},children:Oe})})}const Ne=["Routine Inspection","Calibration","Repair","Preventive Maintenance","Software Update","Hardware Update","Safety Check"];function Ds(){const[He,Oe]=n.useState([]),[N,z]=n.useState([]),[ne,Ve]=n.useState([]),[xe,ct]=n.useState([]),[Ge,ot]=n.useState([]),[ae,ie]=n.useState(!0),[me,R]=n.useState(null),[Bt,pe]=n.useState(!1),[I,Re]=n.useState(null),[B,Qt]=n.useState(null),[Jt,je]=n.useState(!1),[l,E]=n.useState({lab_id:"",scheduled_date:"",type:"",description:"",status:"scheduled",technician_notes:""}),[re,U]=n.useState(!0),[fe,S]=n.useState(null),[Kt,be]=n.useState(!1),[Xt,ge]=n.useState(!1),[y,Be]=n.useState(null),[H,Yt]=n.useState(null),[k,Qe]=n.useState(""),[le,ut]=n.useState(""),[de,ht]=n.useState(""),[Je,xt]=n.useState(""),[O,Ke]=n.useState(""),[M,Xe]=n.useState(""),[ye,Zt]=n.useState(""),[Ye,es]=n.useState(""),[ce,ts]=n.useState(""),[Ze,ss]=n.useState(!1),[et,mt]=n.useState(!1),[ve,ns]=n.useState(0),[tt,as]=n.useState(0),[we,is]=n.useState(0),[Ce,rs]=n.useState(1),[_e,ls]=n.useState(1),[pt,Q]=n.useState(!1),[jt,oe]=n.useState(""),J=6,[a,q]=n.useState({equipment_id:"",scheduled_date:"",type:"",description:"",status:"scheduled",units:0,technician_notes:""});n.useEffect(()=>{st(),nt(),ds()},[]);const ds=async()=>{try{const{data:t,error:s}=await u.from("users").select("*");if(s)throw s;Oe(t)}catch(t){console.error("Error fetching users:",t.message)}},st=async()=>{try{U(!0);const{data:{user:t}}=await u.auth.getUser();if(!t)throw new Error("User not authenticated");const s=t.id,{data:h,error:x}=await u.from("lab").select("id").eq("manager_id",s);if(x)throw x;if(!h||h.length===0){z([]),Ve([]);return}const b=h.map(V=>V.id),{data:o,error:p}=await u.from("equipment").select("id").in("lab_id",b);if(p)throw p;if(!o||o.length===0){z([]),Ve([]);return}const j=o.map(V=>V.id),[g,Y]=await Promise.all([u.from("maintenance_schedules").select(`
            *,
            equipment (
              id,
              name,
              category,
              manufacturer,
              model,
              quantity,
              status,
              lab_id
            )
          `).in("equipment_id",j).order("scheduled_date",{ascending:!0}),u.from("equipment").select("*").in("id",j).order("name")]);if(g.error)throw g.error;if(Y.error)throw Y.error;const it=g.data.filter(V=>j.includes(V.equipment_id));z(it),Ve(Y.data)}catch(t){S(t.message)}finally{U(!1)}},nt=async()=>{try{ie(!0),R(null);const{data:{user:t}}=await u.auth.getUser();if(!t)throw new Error("User not authenticated");const s=t.id,{data:h,error:x}=await u.from("lab").select("id, name, status",{count:"exact"}).eq("manager_id",s);if(x)throw x;if(!h||h.length===0){ct([]),ot([]);return}const b=h.map(g=>g.id),[o,p]=await Promise.all([u.from("lab_maintenance_schedules").select(`
            *,
            lab (
              id,
              name,
              location,
              status
            )
          `).in("lab_id",b).order("scheduled_date",{ascending:!0}),u.from("lab").select("*").in("id",b).order("name")]);if(o.error)throw o.error;if(p.error)throw p.error;const j=o.data?.filter(g=>b.includes(g.lab_id))||[];ct(j),ot(p.data)}catch(t){R(t.message||"Failed to fetch lab maintenance data"),console.error("Error fetching lab data:",t)}finally{ie(!1)}},K=t=>{t?(E({lab_id:t.lab_id,scheduled_date:t.scheduled_date.split("T")[0],type:t.type,description:t.description,status:t.status,technician_notes:t.technician_notes||""}),Re(t)):(E({lab_id:"",scheduled_date:L(new Date,"yyyy-MM-dd'T'HH:mm"),type:"",description:"",status:"scheduled",technician_notes:""}),Re(null)),pe(!0)},ft=t=>{Qt(t),je(!0)},cs=async()=>{if(B)try{U(!0);const{error:t}=await u.from("lab_maintenance_schedules").delete().eq("id",B.id);if(t)throw t;oe("Lab maintenance schedule deleted successfully"),Q(!0),nt()}catch(t){S(t.message)}finally{U(!1),je(!1)}},at=async(t,s,h)=>{try{const{error:x}=await u.from("notifications").insert(He.map(b=>({id:crypto.randomUUID(),user_id:b.id,title:t,message:s,type:h,read:!1,created_at:new Date().toISOString()})));if(x)throw x}catch(x){console.error("Error sending notifications:",x.message)}},bt=async t=>{if(t.preventDefault(),ie(!0),R(null),!l.lab_id||!l.scheduled_date||!l.type){R("Please fill in all required fields"),ie(!1);return}try{const{data:s,error:h}=await u.from("lab").select("status").eq("id",l.lab_id).single();if(h)throw h;if(!s)throw new Error("Lab not found");if(!I){if(s.status==="occupied")throw new Error("Lab is currently occupied and cannot be scheduled for maintenance");if(s.status==="maintenance")throw new Error("Lab is already under maintenance");if(s.status!=="available")throw new Error("Lab is not available for maintenance")}let x;if(I?(x=await u.from("lab_maintenance_schedules").update(l).eq("id",I.id).single(),l.status==="in_progress"?await u.from("lab").update({status:"maintenance"}).eq("id",l.lab_id):["completed","cancelled"].includes(l.status)&&await u.from("lab").update({status:"available"}).eq("id",l.lab_id)):(x=await u.from("lab_maintenance_schedules").insert([l]).single(),l.status==="in_progress"&&await u.from("lab").update({status:"maintenance"}).eq("id",l.lab_id)),x.error)throw x.error;const b=Ge.find(g=>g.id===l.lab_id),o=I?"updated":"scheduled",p=`Lab Maintenance ${o.charAt(0).toUpperCase()+o.slice(1)}: ${b?.name}`;let j=`Maintenance for lab "${b?.name}" has been ${o}. `;j+=`Status: ${l.status}. `,j+=`Type: ${l.type}.`,await at(p,j,"info"),pe(!1),oe(I?"Lab maintenance schedule updated successfully":"Lab maintenance schedule created successfully"),Q(!0),nt()}catch(s){R(s.message||"Failed to save lab maintenance schedule"),console.error("Error:",s)}finally{ie(!1)}},X=t=>{if(t&&(t.status==="completed"||t.status==="cancelled")){S("Cannot edit a completed or cancelled maintenance schedule");return}t?(q({equipment_id:t.equipment_id,scheduled_date:t.scheduled_date.split("T")[0],type:t.type,description:t.description,status:t.status,units:t.units,technician_notes:t.technician_notes||""}),Be(t)):(q({equipment_id:"",scheduled_date:L(new Date,"yyyy-MM-dd'T'HH:mm"),type:"",description:"",status:"scheduled",units:0,technician_notes:""}),Be(null)),be(!0)},gt=t=>{Yt(t),ge(!0)},os=async()=>{if(H)try{U(!0);const{error:t}=await u.from("maintenance_schedules").delete().eq("id",H.id);if(t)throw t;oe("Maintenance schedule deleted successfully"),Q(!0),st()}catch(t){S(t.message)}finally{U(!1),ge(!1)}},yt=async t=>{t.preventDefault(),U(!0),S(null);try{const{equipment_id:s,scheduled_date:h,units:x}=a;if(y&&y.status===a.status){S("No changes detected in the status");return}if(!s||!h||!x){S("Please fill in all required fields");return}if(x<=0){S("Units must be greater than 0");return}const b=new Date(h);if(isNaN(b.getTime())){S("Invalid scheduled date");return}if(b<new Date){S("Scheduled date cannot be in the past");return}const{data:o,error:p}=await u.from("equipment").select("quantity, units_under_maintenance").eq("id",s).single();if(p)throw p;const{quantity:j,units_under_maintenance:g}=o,Y=new Date(h),it=new Date(Y.getTime()+1*60*60*1e3),{data:V,error:St}=await u.from("reservations").select("*").eq("equipment_id",s).in("status",["approved","pending"]).or(`start_time.lte.${it.toISOString()},end_time.gte.${Y.toISOString()}`);if(St)throw St;const bs=V.reduce((P,D)=>P+D.quantity,0);let rt=g;if(y){const P=y.units;rt-=P}const Dt=j-bs-rt;if(x>Dt)throw new Error(`Not enough available units. Requested: ${x}, Available: ${Dt}`);const qt={...a,completed_at:a.status==="completed"?new Date().toISOString():null};if(y){const{error:P}=await u.from("maintenance_schedules").update(qt).eq("id",y.id);if(P)throw P;const D=y.units;let v=rt;a.status==="completed"||a.status==="cancelled"?v-=D:a.status===y.status?v+=a.units-D:((y.status==="completed"||y.status==="cancelled")&&(v+=D),(a.status==="in_progress"||a.status==="scheduled")&&(v=Math.max(v,a.units))),v=Math.max(0,Math.min(v,j));let ue="operational";v===j&&(ue="maintenance");const{error:he}=await u.from("equipment").update({units_under_maintenance:v,status:ue}).eq("id",s);if(he)throw he;const G=ne.find(gs=>gs.id===a.equipment_id),lt=`Maintenance Schedule Updated: ${G?.name}`;let Z=`The maintenance schedule for "${G?.name}" has been updated to "${a.status}".`;a.status==="in_progress"?Z+=` "${G?.units_under_maintenance}" units of this equipment are now under maintenance.`:a.status==="completed"?Z+=` The maintenance has been completed and "${G?.units_under_maintenance}" units of this equipment are now available for reservations.`:a.status==="cancelled"&&(Z+=` The maintenance has been cancelled and "${G?.units_under_maintenance}" units of this equipment are now available for reservations.`),await at(lt,Z,"info"),oe("Maintenance schedule updated successfully")}else{const{error:P}=await u.from("maintenance_schedules").insert([qt]);if(P)throw P;let D=g+a.units;D=Math.min(D,j);let v="operational";D===j&&(v="maintenance");const{error:ue}=await u.from("equipment").update({units_under_maintenance:D,status:v}).eq("id",s);if(ue)throw ue;oe("Maintenance scheduled successfully");const he=ne.find(Z=>Z.id===a.equipment_id),G=`New Maintenance Scheduled: ${he?.name}`,lt=`A new maintenance schedule has been created for "${he?.name}" with "${a.units}" units.`;await at(G,lt,"info")}be(!1),Q(!0),st()}catch(s){S(s.message)}finally{U(!1)}},Se=t=>{switch(t){case"scheduled":return"primary";case"in_progress":return"warning";case"completed":return"success";case"cancelled":return"error";default:return"default"}},us=(t,s)=>{ns(s)},hs=(t,s)=>{as(s)},xs=(t,s)=>{is(s)},vt=(t,s)=>{rs(s)},wt=(t,s)=>{ls(s)},ms=t=>{const s=N.find(h=>h.id===t.event.id);s&&X(s)},ps=t=>{const s=xe.find(h=>h.id===t.event.id);s&&K(s)},De=N.filter(t=>{const s=t.equipment?.name?.toLowerCase().includes(k.toLowerCase())||t.description?.toLowerCase().includes(k.toLowerCase())||t.type?.toLowerCase().includes(k.toLowerCase())||t.units.toString().includes(k.toLowerCase()),h=!le||t.status===le,x=!O||t.type===O;let b=!0;const o=Lt(t.scheduled_date),p=new Date;if(M==="today")b=se(o);else if(M==="upcoming")b=Ee(o,p);else if(M==="past")b=ke(o,p);else if(M==="thisWeek"){const j=Rt(p,7);b=Ee(o,p)&&ke(o,j)}return s&&h&&x&&b}),qe=xe.filter(t=>{const s=t.lab?.name?.toLowerCase().includes(ye.toLowerCase())||t.description?.toLowerCase().includes(ye.toLowerCase())||t.type?.toLowerCase().includes(ye.toLowerCase()),h=!Je||t.lab_id===Je,x=!de||t.status===de,b=!Ye||t.type===Ye;let o=!0;const p=Lt(t.scheduled_date),j=new Date;if(ce==="today")o=se(p);else if(ce==="upcoming")o=Ee(p,j);else if(ce==="past")o=ke(p,j);else if(ce==="thisWeek"){const g=Rt(j,7);o=Ee(p,j)&&ke(p,g)}return s&&h&&x&&b&&o}),Le=Math.ceil(De.length/J),Te=Math.ceil(qe.length/J),Ct=De.slice((Ce-1)*J,Ce*J),_t=qe.slice((_e-1)*J,_e*J),js=N.map(t=>({id:t.id,title:`${t.type}: ${t.equipment?.name}`,start:t.scheduled_date,backgroundColor:t.status==="completed"?"#4caf50":t.status==="in_progress"?"#ff9800":t.status==="cancelled"?"#f44336":"#2196f3",borderColor:t.status==="completed"?"#2e7d32":t.status==="in_progress"?"#e65100":t.status==="cancelled"?"#c62828":"#1565c0",extendedProps:{status:t.status,description:t.description,equipment:t.equipment}})),fs=xe.map(t=>({id:t.id,title:`${t.type}: ${t.lab?.name}`,start:t.scheduled_date,backgroundColor:t.status==="completed"?"#4caf50":t.status==="in_progress"?"#ff9800":t.status==="cancelled"?"#f44336":"#2196f3",borderColor:t.status==="completed"?"#2e7d32":t.status==="in_progress"?"#e65100":t.status==="cancelled"?"#c62828":"#1565c0",extendedProps:{status:t.status,description:t.description,equipment:t.lab}}));return re&&N.length===0?e.jsx(ee,{}):ae&&xe.length===0?e.jsx(ee,{}):e.jsx(i,{children:e.jsxs(i,{children:[e.jsx(i,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(dt,{value:tt,onChange:hs,"aria-label":"maintenance view tabs",children:[e.jsx(F,{label:"Lab Maintenance Scheduling"}),e.jsx(F,{label:"Maintenance Scheduling"})]})}),e.jsxs($,{value:tt,index:0,children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(d,{variant:"h5",fontWeight:"bold",children:"Lab Maintenance Scheduling"}),e.jsx(f,{variant:"contained",color:"primary",startIcon:e.jsx(Ae,{}),onClick:()=>K(),children:"Schedule a Lab Maintenance"})]}),me&&e.jsx(Me,{severity:"error",sx:{mb:3},onClose:()=>R(null),children:me}),e.jsxs(A,{sx:{p:2,mb:3},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(W,{placeholder:"Search lab maintenance schedules...",variant:"outlined",size:"small",value:ye,onChange:t=>Zt(t.target.value),InputProps:{startAdornment:e.jsx(Tt,{position:"start",children:e.jsx(Et,{})})},sx:{width:300}}),e.jsx(f,{variant:"outlined",startIcon:e.jsx(kt,{}),onClick:()=>mt(!et),size:"small",children:et?"Hide Lab Filters":"Show Lab Filters"})]}),et&&e.jsxs(i,{sx:{mt:2},children:[e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{item:!0,xs:12,sm:3,children:e.jsxs(w,{fullWidth:!0,size:"small",children:[e.jsx(C,{children:"Lab"}),e.jsxs(_,{value:Je,label:"Lab",onChange:t=>xt(t.target.value),children:[e.jsx(r,{value:"",children:"All Labs"}),Ge.map(t=>e.jsx(r,{value:t.id,children:t.name},t.id))]})]})}),e.jsx(c,{item:!0,xs:12,sm:3,children:e.jsxs(w,{fullWidth:!0,size:"small",children:[e.jsx(C,{children:"Status"}),e.jsxs(_,{value:de,label:"Status",onChange:t=>ht(t.target.value),children:[e.jsx(r,{value:"",children:"All"}),e.jsx(r,{value:"scheduled",children:"Scheduled"}),e.jsx(r,{value:"in_progress",children:"In Progress"}),e.jsx(r,{value:"completed",children:"Completed"}),e.jsx(r,{value:"cancelled",children:"Cancelled"})]})]})}),e.jsx(c,{item:!0,xs:12,sm:3,children:e.jsxs(w,{fullWidth:!0,size:"small",children:[e.jsx(C,{children:"Type"}),e.jsxs(_,{value:Ye,label:"Type",onChange:t=>es(t.target.value),children:[e.jsx(r,{value:"",children:"All Types"}),Ne.map(t=>e.jsx(r,{value:t,children:t},t))]})]})}),e.jsx(c,{item:!0,xs:12,sm:3,children:e.jsxs(w,{fullWidth:!0,size:"small",children:[e.jsx(C,{children:"Date"}),e.jsxs(_,{value:ce,label:"Date",onChange:t=>ts(t.target.value),children:[e.jsx(r,{value:"",children:"All Dates"}),e.jsx(r,{value:"today",children:"Today"}),e.jsx(r,{value:"upcoming",children:"Upcoming"}),e.jsx(r,{value:"thisWeek",children:"This Week"}),e.jsx(r,{value:"past",children:"Past"})]})]})})]}),e.jsx(i,{sx:{mt:2,display:"flex",justifyContent:"flex-end"},children:e.jsx(f,{variant:"text",color:"secondary",size:"small",onClick:()=>{Qe(""),xt(""),ht(""),Ke(""),Xe(""),mt(!1)},children:"Clear Lab Filters"})})]})]}),e.jsx(i,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(dt,{value:we,onChange:xs,"aria-label":"lab maintenance view tabs",children:[e.jsx(F,{label:"Lab Grid View"}),e.jsx(F,{label:"Lab Table View"}),e.jsx(F,{label:"Lab Calendar View",icon:e.jsx(Mt,{}),iconPosition:"start"})]})}),e.jsxs($,{value:we,index:0,children:[e.jsx(c,{container:!0,spacing:3,children:qe.length>0?_t.map(t=>e.jsx(c,{item:!0,xs:12,sm:6,md:4,children:e.jsx(Pt,{sx:{height:"100%"},children:e.jsxs(Wt,{children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:t.lab?.name}),e.jsxs(i,{children:[e.jsx(Pe,{title:"Edit",children:e.jsx(We,{size:"small",onClick:()=>K(t),sx:{mr:1},children:e.jsx(zt,{fontSize:"small"})})}),e.jsx(Pe,{title:"Delete",children:e.jsx(We,{size:"small",color:"error",onClick:()=>ft(t),children:e.jsx(Gt,{fontSize:"small"})})})]})]}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(T,{label:t.type,size:"small",sx:{mr:1,mb:1}}),e.jsx(T,{label:t.status,color:Se(t.status),size:"small",sx:{mb:1}})]}),e.jsx(i,{component:"span",fontWeight:"medium",children:"Scheduled:"})," ",L(new Date(t.scheduled_date),"PPp"),se(new Date(t.scheduled_date))&&e.jsx(T,{label:"Today",color:"error",size:"small",sx:{ml:1}}),e.jsx(d,{variant:"body2",paragraph:!0,children:t.description}),t.technician_notes&&e.jsxs(i,{sx:{mt:1},children:[e.jsx(d,{variant:"body2",color:"text.secondary",fontWeight:"medium",children:"Notes:"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:t.technician_notes})]}),e.jsx(i,{sx:{mt:2},children:e.jsx(f,{size:"small",variant:"outlined",onClick:()=>K(t),children:"Update Status"})})]})})},t.id)):e.jsx(c,{item:!0,xs:12,children:e.jsxs(A,{sx:{p:3,textAlign:"center"},children:[e.jsx(d,{variant:"h6",children:"No Lab maintenance schedules found"}),e.jsx(d,{variant:"body1",color:"text.secondary",paragraph:!0,children:k||de||O||M?"Try adjusting your search or filter criteria":"No Lab maintenance schedules have been created yet"}),!k&&!de&&!O&&!M&&e.jsx(f,{variant:"contained",startIcon:e.jsx(Ae,{}),onClick:()=>K(),sx:{mt:2},children:"Schedule Lab Maintenance"})]})})}),Te>1&&e.jsx(i,{sx:{display:"flex",justifyContent:"center",mt:3},children:e.jsx($e,{count:Te,page:_e,onChange:wt,color:"primary"})})]}),e.jsxs($,{value:we,index:1,children:[e.jsx(It,{component:A,children:e.jsxs(Ut,{children:[e.jsx(Ft,{children:e.jsxs(te,{children:[e.jsx(m,{children:"Lab"}),e.jsx(m,{children:"Type"}),e.jsx(m,{children:"Scheduled Date"}),e.jsx(m,{children:"Status"}),e.jsx(m,{children:"Actions"})]})}),e.jsx(At,{children:qe.length>0?_t.map(t=>e.jsxs(te,{children:[e.jsxs(m,{children:[e.jsx(d,{variant:"body2",fontWeight:"medium",children:t.lab?.name}),e.jsx(d,{variant:"caption",color:"text.secondary",children:t.lab?.location})]}),e.jsx(m,{children:t.type}),e.jsxs(m,{children:[L(new Date(t.scheduled_date),"PPp"),se(new Date(t.scheduled_date))&&e.jsx(T,{label:"Today",color:"error",size:"small",sx:{ml:1}})]}),e.jsx(m,{children:e.jsx(T,{label:t.status,color:Se(t.status),size:"small"})}),e.jsx(m,{children:e.jsxs(i,{sx:{display:"flex",gap:1},children:[e.jsx(f,{size:"small",variant:"outlined",onClick:()=>K(t),children:"Edit"}),e.jsx(f,{size:"small",variant:"outlined",color:"error",onClick:()=>ft(t),children:"Delete"})]})})]},t.id)):e.jsx(te,{children:e.jsxs(m,{colSpan:5,align:"center",children:[e.jsx(d,{variant:"subtitle1",sx:{py:2},children:"No Lab maintenance schedules found"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Try adjusting your search or filter criteria"})]})})})]})}),Te>1&&e.jsx(i,{sx:{display:"flex",justifyContent:"center",mt:3},children:e.jsx($e,{count:Te,page:_e,onChange:wt,color:"primary"})})]}),e.jsx($,{value:we,index:2,children:e.jsx(A,{sx:{p:2},children:e.jsx($t,{plugins:[Nt,Ht,Ot],initialView:"dayGridMonth",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},events:fs,eventClick:ps,height:"auto",aspectRatio:1.5})})}),e.jsxs(ze,{open:Bt,onClose:()=>{pe(!1),E({lab_id:"",scheduled_date:L(new Date,"yyyy-MM-dd'T'HH:mm"),type:"",description:"",status:"scheduled",technician_notes:""}),Re(null)},maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ie,{children:I?"Update Lab Maintenance Schedule":"Lab Schedule Maintenance"}),e.jsxs(Ue,{children:[me&&e.jsx(Me,{severity:"error",sx:{mb:2},children:me}),e.jsx("form",{onSubmit:bt,children:e.jsxs(c,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(c,{item:!0,xs:12,children:e.jsxs(w,{fullWidth:!0,required:!0,children:[e.jsx(C,{children:"Lab"}),e.jsx(_,{value:l.lab_id,label:"Lab",onChange:t=>E({...l,lab_id:t.target.value}),children:Ge.map(t=>e.jsxs(r,{value:t.id,children:[t.name," (",t.location,")"]},t.id))})]})}),e.jsx(c,{item:!0,xs:12,children:e.jsxs(w,{fullWidth:!0,required:!0,children:[e.jsx(C,{children:"Maintenance Type"}),e.jsx(_,{value:l.type,label:"Maintenance Type",onChange:t=>E({...l,type:t.target.value}),children:Ne.map(t=>e.jsx(r,{value:t,children:t},t))})]})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(W,{type:"datetime-local",label:"Scheduled Date",fullWidth:!0,required:!0,value:l.scheduled_date,onChange:t=>E({...l,scheduled_date:t.target.value}),InputLabelProps:{shrink:!0}})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(W,{label:"Description",fullWidth:!0,multiline:!0,rows:3,value:l.description,onChange:t=>E({...l,description:t.target.value}),placeholder:"Describe the maintenance to be performed"})}),I&&e.jsxs(e.Fragment,{children:[e.jsx(c,{item:!0,xs:12,children:e.jsxs(w,{fullWidth:!0,required:!0,children:[e.jsx(C,{children:"Status"}),e.jsxs(_,{value:l.status,label:"Status",onChange:t=>E({...l,status:t.target.value}),children:[e.jsx(r,{value:l.status,disabled:!0,children:l.status.charAt(0).toUpperCase()+l.status.slice(1).replace("_"," ")}),["scheduled","in_progress","completed","cancelled"].filter(t=>t!==l.status).map(t=>e.jsx(r,{value:t,children:t.charAt(0).toUpperCase()+t.slice(1).replace("_"," ")},t))]})]})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(W,{label:"Technician Notes",fullWidth:!0,multiline:!0,rows:3,value:l.technician_notes,onChange:t=>E({...l,technician_notes:t.target.value}),placeholder:"Add notes about the maintenance performed or issues encountered"})})]})]})})]}),e.jsxs(Fe,{children:[e.jsx(f,{onClick:()=>pe(!1),children:"Cancel"}),e.jsx(f,{onClick:bt,color:"primary",variant:"contained",disabled:ae,children:ae?e.jsx(ee,{size:24}):I?"Update":"Schedule"})]})]}),e.jsxs(ze,{open:Jt,onClose:()=>je(!1),children:[e.jsx(Ie,{children:"Confirm Deletion"}),e.jsxs(Ue,{children:[e.jsxs(d,{children:['Are you sure you want to delete this lab maintenance schedule for "',B?.lab?.name,'"?']}),B&&e.jsxs(i,{sx:{mt:2},children:[e.jsxs(d,{variant:"body2",children:[e.jsx("strong",{children:"Scheduled Date:"})," ",L(new Date(B.scheduled_date),"PPp")]}),e.jsxs(d,{variant:"body2",children:[e.jsx("strong",{children:"Status:"})," ",B.status]})]})]}),e.jsxs(Fe,{children:[e.jsx(f,{onClick:()=>je(!1),children:"Cancel"}),e.jsx(f,{onClick:cs,color:"error",variant:"contained",disabled:ae,children:ae?e.jsx(ee,{size:24}):"Delete"})]})]}),e.jsx(Vt,{open:pt,autoHideDuration:6e3,onClose:()=>Q(!1),message:jt})]}),e.jsxs($,{value:tt,index:1,children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(d,{variant:"h5",fontWeight:"bold",children:"Maintenance Scheduling"}),e.jsx(f,{variant:"contained",color:"primary",startIcon:e.jsx(Ae,{}),onClick:()=>X(),children:"Schedule Equipment Maintenance"})]}),fe&&e.jsx(Me,{severity:"error",sx:{mb:3},onClose:()=>S(null),children:fe}),e.jsxs(A,{sx:{p:2,mb:3},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(W,{placeholder:"Search maintenance schedules...",variant:"outlined",size:"small",value:k,onChange:t=>Qe(t.target.value),InputProps:{startAdornment:e.jsx(Tt,{position:"start",children:e.jsx(Et,{})})},sx:{width:300}}),e.jsx(f,{variant:"outlined",startIcon:e.jsx(kt,{}),onClick:()=>ss(!Ze),size:"small",children:Ze?"Hide Filters":"Show Filters"})]}),Ze&&e.jsxs(i,{sx:{mt:2},children:[e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{item:!0,xs:12,sm:4,children:e.jsxs(w,{fullWidth:!0,size:"small",children:[e.jsx(C,{children:"Status"}),e.jsxs(_,{value:le,label:"Status",onChange:t=>ut(t.target.value),children:[e.jsx(r,{value:"",children:"All Statuses"}),e.jsx(r,{value:"scheduled",children:"Scheduled"}),e.jsx(r,{value:"in_progress",children:"In Progress"}),e.jsx(r,{value:"completed",children:"Completed"}),e.jsx(r,{value:"cancelled",children:"Cancelled"})]})]})}),e.jsx(c,{item:!0,xs:12,sm:4,children:e.jsxs(w,{fullWidth:!0,size:"small",children:[e.jsx(C,{children:"Type"}),e.jsxs(_,{value:O,label:"Type",onChange:t=>Ke(t.target.value),children:[e.jsx(r,{value:"",children:"All Types"}),Ne.map(t=>e.jsx(r,{value:t,children:t},t))]})]})}),e.jsx(c,{item:!0,xs:12,sm:4,children:e.jsxs(w,{fullWidth:!0,size:"small",children:[e.jsx(C,{children:"Date"}),e.jsxs(_,{value:M,label:"Date",onChange:t=>Xe(t.target.value),children:[e.jsx(r,{value:"",children:"All Dates"}),e.jsx(r,{value:"today",children:"Today"}),e.jsx(r,{value:"upcoming",children:"Upcoming"}),e.jsx(r,{value:"thisWeek",children:"This Week"}),e.jsx(r,{value:"past",children:"Past"})]})]})})]}),e.jsx(i,{sx:{mt:2,display:"flex",justifyContent:"flex-end"},children:e.jsx(f,{variant:"text",color:"secondary",size:"small",onClick:()=>{Qe(""),ut(""),Ke(""),Xe("")},children:"Clear Filters"})})]})]}),e.jsx(i,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(dt,{value:ve,onChange:us,"aria-label":"maintenance view tabs",children:[e.jsx(F,{label:"Grid View"}),e.jsx(F,{label:"Table View"}),e.jsx(F,{label:"Calendar View",icon:e.jsx(Mt,{}),iconPosition:"start"})]})}),e.jsxs($,{value:ve,index:0,children:[e.jsx(c,{container:!0,spacing:3,children:De.length>0?Ct.map(t=>e.jsx(c,{item:!0,xs:12,sm:6,md:4,children:e.jsx(Pt,{sx:{height:"100%"},children:e.jsxs(Wt,{children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:t.equipment?.name}),e.jsxs(i,{children:[e.jsx(Pe,{title:"Edit",children:e.jsx(We,{size:"small",onClick:()=>X(t),sx:{mr:1},children:e.jsx(zt,{fontSize:"small"})})}),e.jsx(Pe,{title:"Delete",children:e.jsx(We,{size:"small",color:"error",onClick:()=>gt(t),children:e.jsx(Gt,{fontSize:"small"})})})]})]}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(T,{label:t.type,size:"small",sx:{mr:1,mb:1}}),e.jsx(T,{label:t.status,color:Se(t.status),size:"small",sx:{mb:1}})]}),e.jsx(i,{sx:{mb:1},children:e.jsxs(d,{variant:"body2",color:"text.secondary",children:[e.jsx(i,{component:"span",fontWeight:"medium",children:"Quantity:"})," ",t.units]})}),e.jsx(i,{component:"span",fontWeight:"medium",children:"Scheduled:"})," ",L(new Date(t.scheduled_date),"PPp"),se(new Date(t.scheduled_date))&&e.jsx(T,{label:"Today",color:"error",size:"small",sx:{ml:1}}),e.jsx(d,{variant:"body2",paragraph:!0,children:t.description}),t.technician_notes&&e.jsxs(i,{sx:{mt:1},children:[e.jsx(d,{variant:"body2",color:"text.secondary",fontWeight:"medium",children:"Notes:"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:t.technician_notes})]}),e.jsx(i,{sx:{mt:2},children:e.jsx(f,{size:"small",variant:"outlined",onClick:()=>X(t),children:"Update Status"})})]})})},t.id)):e.jsx(c,{item:!0,xs:12,children:e.jsxs(A,{sx:{p:3,textAlign:"center"},children:[e.jsx(d,{variant:"h6",children:"No Equipment maintenance schedules found"}),e.jsx(d,{variant:"body1",color:"text.secondary",paragraph:!0,children:k||le||O||M?"Try adjusting your search or filter criteria":"No Equipment maintenance schedules have been created yet"}),!k&&!le&&!O&&!M&&e.jsx(f,{variant:"contained",startIcon:e.jsx(Ae,{}),onClick:()=>X(),sx:{mt:2},children:"Schedule Maintenance"})]})})}),Le>1&&e.jsx(i,{sx:{display:"flex",justifyContent:"center",mt:3},children:e.jsx($e,{count:Le,page:Ce,onChange:vt,color:"primary"})})]}),e.jsxs($,{value:ve,index:1,children:[e.jsx(It,{component:A,children:e.jsxs(Ut,{children:[e.jsx(Ft,{children:e.jsxs(te,{children:[e.jsx(m,{children:"Equipment"}),e.jsx(m,{children:"Type"}),e.jsx(m,{children:"Scheduled Date"}),e.jsx(m,{children:"Status"}),e.jsx(m,{children:"Units"}),e.jsx(m,{children:"Actions"})]})}),e.jsx(At,{children:De.length>0?Ct.map(t=>e.jsxs(te,{children:[e.jsxs(m,{children:[e.jsx(d,{variant:"body2",fontWeight:"medium",children:t.equipment?.name}),e.jsx(d,{variant:"caption",color:"text.secondary",children:t.equipment?.category})]}),e.jsx(m,{children:t.type}),e.jsxs(m,{children:[L(new Date(t.scheduled_date),"PPp"),se(new Date(t.scheduled_date))&&e.jsx(T,{label:"Today",color:"error",size:"small",sx:{ml:1}})]}),e.jsx(m,{children:e.jsx(T,{label:t.status,color:Se(t.status),size:"small"})}),e.jsx(m,{children:t.units}),e.jsx(m,{children:e.jsxs(i,{sx:{display:"flex",gap:1},children:[e.jsx(f,{size:"small",variant:"outlined",onClick:()=>X(t),children:"Edit"}),e.jsx(f,{size:"small",variant:"outlined",color:"error",onClick:()=>gt(t),children:"Delete"})]})})]},t.id)):e.jsx(te,{children:e.jsxs(m,{colSpan:5,align:"center",children:[e.jsx(d,{variant:"subtitle1",sx:{py:2},children:"No Equipment maintenance schedules found"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Try adjusting your search or filter criteria"})]})})})]})}),Le>1&&e.jsx(i,{sx:{display:"flex",justifyContent:"center",mt:3},children:e.jsx($e,{count:Le,page:Ce,onChange:vt,color:"primary"})})]}),e.jsx($,{value:ve,index:2,children:e.jsx(A,{sx:{p:2},children:e.jsx($t,{plugins:[Nt,Ht,Ot],initialView:"dayGridMonth",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},events:js,eventClick:ms,height:"auto",aspectRatio:1.5})})}),e.jsxs(ze,{open:Kt,onClose:()=>{be(!1),q({equipment_id:"",scheduled_date:L(new Date,"yyyy-MM-dd'T'HH:mm"),type:"",description:"",status:"scheduled",units:0,technician_notes:""}),Be(null)},maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ie,{children:y?"Update Maintenance Schedule":"Schedule Maintenance"}),e.jsxs(Ue,{children:[fe&&e.jsx(Me,{severity:"error",sx:{mb:2},children:fe}),e.jsx("form",{onSubmit:yt,children:e.jsxs(c,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(c,{item:!0,xs:12,children:e.jsxs(w,{fullWidth:!0,required:!0,children:[e.jsx(C,{children:"Equipment"}),e.jsx(_,{value:a.equipment_id,label:"Equipment",onChange:t=>q({...a,equipment_id:t.target.value}),children:ne.map(t=>e.jsxs(r,{value:t.id,children:[t.name," (",t.category,") (",t.quantity," units)"]},t.id))})]})}),e.jsx(c,{item:!0,xs:12,children:e.jsxs(w,{fullWidth:!0,required:!0,children:[e.jsx(C,{children:"Maintenance Type"}),e.jsx(_,{value:a.type,label:"Maintenance Type",onChange:t=>q({...a,type:t.target.value}),children:Ne.map(t=>e.jsx(r,{value:t,children:t},t))})]})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(W,{margin:"dense",label:"How many units need to be maintained?",type:"number",fullWidth:!0,required:!0,value:a.units,onChange:t=>q({...a,units:Number(t.target.value)}),InputProps:{inputProps:{min:1}}})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(W,{type:"datetime-local",label:"Scheduled Date",fullWidth:!0,required:!0,value:a.scheduled_date,onChange:t=>q({...a,scheduled_date:t.target.value}),InputLabelProps:{shrink:!0}})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(W,{label:"Description",fullWidth:!0,multiline:!0,rows:3,value:a.description,onChange:t=>q({...a,description:t.target.value}),placeholder:"Describe the maintenance to be performed"})}),y&&e.jsxs(e.Fragment,{children:[e.jsx(c,{item:!0,xs:12,children:e.jsxs(w,{fullWidth:!0,required:!0,children:[e.jsx(C,{children:"Status"}),e.jsxs(_,{value:a.status,label:"Status",onChange:t=>q({...a,status:t.target.value}),children:[e.jsx(r,{value:a.status,disabled:!0,children:a.status.charAt(0).toUpperCase()+a.status.slice(1).replace("_"," ")}),["scheduled","in_progress","completed","cancelled"].filter(t=>t!==a.status).map(t=>e.jsx(r,{value:t,children:t.charAt(0).toUpperCase()+t.slice(1).replace("_"," ")},t))]})]})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(W,{label:"Technician Notes",fullWidth:!0,multiline:!0,rows:3,value:a.technician_notes,onChange:t=>q({...a,technician_notes:t.target.value}),placeholder:"Add notes about the maintenance performed or issues encountered"})})]})]})})]}),e.jsxs(Fe,{children:[e.jsx(f,{onClick:()=>be(!1),children:"Cancel"}),e.jsx(f,{onClick:yt,color:"primary",variant:"contained",disabled:re,children:re?e.jsx(ee,{size:24}):y?"Update":"Schedule"})]})]}),e.jsxs(ze,{open:Xt,onClose:()=>ge(!1),children:[e.jsx(Ie,{children:"Confirm Deletion"}),e.jsxs(Ue,{children:[e.jsxs(d,{children:['Are you sure you want to delete this maintenance schedule for "',H?.equipment?.name,'"?']}),H&&e.jsxs(i,{sx:{mt:2},children:[e.jsxs(d,{variant:"body2",children:[e.jsx("strong",{children:"Type:"})," ",H.type]}),e.jsxs(d,{variant:"body2",children:[e.jsx("strong",{children:"Scheduled Date:"})," ",L(new Date(H.scheduled_date),"PPp")]}),e.jsxs(d,{variant:"body2",children:[e.jsx("strong",{children:"Status:"})," ",H.status]})]})]}),e.jsxs(Fe,{children:[e.jsx(f,{onClick:()=>ge(!1),children:"Cancel"}),e.jsx(f,{onClick:os,color:"error",variant:"contained",disabled:re,children:re?e.jsx(ee,{size:24}):"Delete"})]})]}),e.jsx(Vt,{open:pt,autoHideDuration:6e3,onClose:()=>Q(!1),message:jt})]})]})})}export{Ds as default};
//# sourceMappingURL=MaintenanceScheduling-BuBYKO_a.js.map
