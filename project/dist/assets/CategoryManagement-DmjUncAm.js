import{r,s as l,j as e,C as D,B as j,T as a,a as c,A as X,P as W,k as q,n as Y,o as Z,G as v,p as ee,t as te,v as I,w as O,x as se,y as re,D as P,h as $,i as L,l as B,z as ae}from"./index-z-43rxTh.js";import{d as ne}from"./Delete-CbxsixXQ.js";import{d as M}from"./Add-DVotoReZ.js";function ce(){const[S,N]=r.useState([]),[d,i]=r.useState(!0),[k,u]=r.useState(null),[F,x]=r.useState(!1),[G,m]=r.useState(!1),[p,_]=r.useState(null),[n,Q]=r.useState(null),[h,H]=r.useState(""),[R,y]=r.useState(!1),[U,C]=r.useState(""),[o,f]=r.useState({name:"",description:""});r.useEffect(()=>{b()},[]);const b=async()=>{try{i(!0);const{data:t,error:s}=await l.from("equipment_categories").select("*").order("name");if(s)throw s;const g=await Promise.all(t.map(async z=>{const{count:V,error:T}=await l.from("equipment").select("*",{count:"exact",head:!0}).eq("category",z.name);if(T)throw T;return{...z,equipment_count:V||0}}));N(g)}catch(t){u(t.message)}finally{i(!1)}},w=t=>{t?(f({name:t.name,description:t.description}),_(t)):(f({name:"",description:""}),_(null)),x(!0)},A=async t=>{t.preventDefault(),i(!0);try{if(p){const{error:s}=await l.from("equipment_categories").update(o).eq("id",p.id);if(s)throw s;C("Category updated successfully")}else{const{error:s}=await l.from("equipment_categories").insert([o]);if(s)throw s;C("Category created successfully")}x(!1),y(!0),b()}catch(s){u(s.message)}finally{i(!1)}},J=t=>{Q(t),m(!0)},K=async()=>{if(n)try{i(!0);const{count:t,error:s}=await l.from("equipment").select("*",{count:"exact",head:!0}).eq("category",n.name);if(s)throw s;if(t&&t>0){u(`Cannot delete category "${n.name}" because it is used by ${t} equipment items.`),m(!1);return}const{error:g}=await l.from("equipment_categories").delete().eq("id",n.id);if(g)throw g;C("Category deleted successfully"),y(!0),b()}catch(t){u(t.message)}finally{i(!1),m(!1)}},E=S.filter(t=>t.name.toLowerCase().includes(h.toLowerCase())||t.description.toLowerCase().includes(h.toLowerCase()));return d&&S.length===0?e.jsx(D,{}):e.jsxs(j,{children:[e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(a,{variant:"h5",fontWeight:"bold",children:"Category Management"}),e.jsx(c,{variant:"contained",color:"primary",startIcon:e.jsx(M,{}),onClick:()=>w(),children:"Add Category"})]}),k&&e.jsx(X,{severity:"error",sx:{mb:3},onClose:()=>u(null),children:k}),e.jsx(W,{sx:{p:2,mb:3},children:e.jsx(q,{fullWidth:!0,placeholder:"Search categories...",value:h,onChange:t=>H(t.target.value),InputProps:{startAdornment:e.jsx(Y,{position:"start",children:e.jsx(Z,{})})},size:"small"})}),e.jsxs(v,{container:!0,spacing:3,children:[E.map(t=>e.jsx(v,{item:!0,xs:12,sm:6,md:4,children:e.jsx(ee,{sx:{height:"100%"},children:e.jsxs(te,{children:[e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[e.jsx(a,{variant:"h6",component:"h3",children:t.name}),e.jsxs(j,{children:[e.jsx(I,{title:"Edit",children:e.jsx(O,{size:"small",onClick:()=>w(t),sx:{mr:1},children:e.jsx(se,{fontSize:"small"})})}),e.jsx(I,{title:"Delete",children:e.jsx(O,{size:"small",color:"error",onClick:()=>J(t),children:e.jsx(ne,{fontSize:"small"})})})]})]}),e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:2},children:t.description||"No description provided"}),e.jsx(re,{label:`${t.equipment_count} equipment items`,size:"small",color:t.equipment_count?"primary":"default",variant:"outlined"})]})})},t.id)),E.length===0&&e.jsx(v,{item:!0,xs:12,children:e.jsxs(W,{sx:{p:3,textAlign:"center"},children:[e.jsx(a,{variant:"subtitle1",children:"No categories found"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:h?"Try adjusting your search query":"Add your first category to get started"}),!h&&e.jsx(c,{variant:"contained",startIcon:e.jsx(M,{}),sx:{mt:2},onClick:()=>w(),children:"Add Category"})]})})]}),e.jsxs(P,{open:F,onClose:()=>x(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx($,{children:p?"Edit Category":"Add Category"}),e.jsx(L,{children:e.jsxs("form",{onSubmit:A,children:[e.jsx(q,{margin:"dense",label:"Name",fullWidth:!0,required:!0,value:o.name,onChange:t=>f({...o,name:t.target.value})}),e.jsx(q,{margin:"dense",label:"Description",fullWidth:!0,multiline:!0,rows:3,value:o.description,onChange:t=>f({...o,description:t.target.value}),placeholder:"Provide a description of this category"})]})}),e.jsxs(B,{children:[e.jsx(c,{onClick:()=>x(!1),children:"Cancel"}),e.jsx(c,{onClick:A,color:"primary",variant:"contained",disabled:d,children:d?e.jsx(D,{size:24}):p?"Update":"Create"})]})]}),e.jsxs(P,{open:G,onClose:()=>m(!1),children:[e.jsx($,{children:"Confirm Deletion"}),e.jsx(L,{children:e.jsxs(a,{children:['Are you sure you want to delete the category "',n?.name,'"?',n?.equipment_count?e.jsxs(a,{color:"error",sx:{mt:1},children:["Warning: This category is used by ",n.equipment_count," equipment items. Deleting it may cause issues."]}):e.jsx(a,{sx:{mt:1},children:"This category is not currently used by any equipment."})]})}),e.jsxs(B,{children:[e.jsx(c,{onClick:()=>m(!1),children:"Cancel"}),e.jsx(c,{onClick:K,color:"error",variant:"contained",disabled:d,children:d?e.jsx(D,{size:24}):"Delete"})]})]}),e.jsx(ae,{open:R,autoHideDuration:6e3,onClose:()=>y(!1),message:U})]})}export{ce as default};
//# sourceMappingURL=CategoryManagement-DmjUncAm.js.map
